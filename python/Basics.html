<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basics | 学习笔记</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/img/logo.ico">
    <link rel="manifest" href="/manifest.json"><link rel='canonical' href='https://bugwriter2.github.io/python/Basics.html'/>
    <meta name="description" content="博客">
    <meta name="google-site-verification" content="PXbr-y9acmnnEmw1zgCFEydL32xlZIf1OfFmzDFUrzI">
    <link rel="preload" href="/assets/css/0.styles.9ce6ac63.css" as="style"><link rel="preload" href="/assets/js/app.3fa2a2e1.js" as="script"><link rel="preload" href="/assets/js/2.057925ea.js" as="script"><link rel="preload" href="/assets/js/29.f0ca98d8.js" as="script"><link rel="prefetch" href="/assets/js/10.9a53695e.js"><link rel="prefetch" href="/assets/js/11.e6f60bd9.js"><link rel="prefetch" href="/assets/js/12.90f3d785.js"><link rel="prefetch" href="/assets/js/13.42e681ed.js"><link rel="prefetch" href="/assets/js/14.7a85d7cd.js"><link rel="prefetch" href="/assets/js/15.402110d9.js"><link rel="prefetch" href="/assets/js/16.776ab4c1.js"><link rel="prefetch" href="/assets/js/17.4af5340c.js"><link rel="prefetch" href="/assets/js/18.bd060f5e.js"><link rel="prefetch" href="/assets/js/19.ac40939f.js"><link rel="prefetch" href="/assets/js/20.ac68ccd2.js"><link rel="prefetch" href="/assets/js/21.90d4b479.js"><link rel="prefetch" href="/assets/js/22.044d8e2b.js"><link rel="prefetch" href="/assets/js/23.606676bb.js"><link rel="prefetch" href="/assets/js/24.e8a14162.js"><link rel="prefetch" href="/assets/js/25.ebdc5e35.js"><link rel="prefetch" href="/assets/js/26.efd6b8fb.js"><link rel="prefetch" href="/assets/js/27.649d5e23.js"><link rel="prefetch" href="/assets/js/28.1c7ccf18.js"><link rel="prefetch" href="/assets/js/3.7c0ca1fc.js"><link rel="prefetch" href="/assets/js/30.540536d8.js"><link rel="prefetch" href="/assets/js/31.3cc7b8a3.js"><link rel="prefetch" href="/assets/js/32.02879a8f.js"><link rel="prefetch" href="/assets/js/33.b1417b92.js"><link rel="prefetch" href="/assets/js/34.0b5079cd.js"><link rel="prefetch" href="/assets/js/35.2828b1d3.js"><link rel="prefetch" href="/assets/js/36.d0d0971a.js"><link rel="prefetch" href="/assets/js/37.6cc365c3.js"><link rel="prefetch" href="/assets/js/38.a184b552.js"><link rel="prefetch" href="/assets/js/39.84a689f9.js"><link rel="prefetch" href="/assets/js/4.7a06b201.js"><link rel="prefetch" href="/assets/js/40.c2d886c6.js"><link rel="prefetch" href="/assets/js/5.0de0ba0e.js"><link rel="prefetch" href="/assets/js/6.cb2a4e71.js"><link rel="prefetch" href="/assets/js/7.f7f97492.js"><link rel="prefetch" href="/assets/js/8.7c626f1f.js"><link rel="prefetch" href="/assets/js/9.b014d1e7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9ce6ac63.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/dv/" class="nav-link">
  Data Visualization
</a></li><li class="dropdown-item"><!----> <a href="/dl/" class="nav-link">
  Deep Learning
</a></li><li class="dropdown-item"><!----> <a href="/dc/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/qa/" class="nav-link">
  Q&amp;A
</a></li><li class="dropdown-item"><!----> <a href="/svc/" class="nav-link">
  Backend Services
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://www.github.com/bugwriter2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link router-link-active">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/dv/" class="nav-link">
  Data Visualization
</a></li><li class="dropdown-item"><!----> <a href="/dl/" class="nav-link">
  Deep Learning
</a></li><li class="dropdown-item"><!----> <a href="/dc/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/qa/" class="nav-link">
  Q&amp;A
</a></li><li class="dropdown-item"><!----> <a href="/svc/" class="nav-link">
  Backend Services
</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://www.github.com/bugwriter2" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/python/Basics.html" aria-current="page" class="active sidebar-link">Basics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/Basics.html#loop" class="sidebar-link">Loop</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#string" class="sidebar-link">String</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#syntax-sugar" class="sidebar-link">Syntax sugar</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#error-handling" class="sidebar-link">Error handling</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#regex" class="sidebar-link">Regex</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#arithmetic" class="sidebar-link">Arithmetic</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#进制" class="sidebar-link">进制</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#list" class="sidebar-link">List</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/Basics.html#basics-2" class="sidebar-link">Basics</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#pydash" class="sidebar-link">pydash</a></li></ul></li><li class="sidebar-sub-header"><a href="/python/Basics.html#logging" class="sidebar-link">Logging</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#import" class="sidebar-link">import</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#oop" class="sidebar-link">OOP</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#pickle" class="sidebar-link">Pickle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/Basics.html#general" class="sidebar-link">general</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#cannot-pickle" class="sidebar-link">Cannot pickle</a></li></ul></li><li class="sidebar-sub-header"><a href="/python/Basics.html#exec-vs-eval" class="sidebar-link">exec vs eval</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#closure" class="sidebar-link">Closure</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#yield" class="sidebar-link">Yield</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#coroutine-and-future" class="sidebar-link">Coroutine and Future</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/Basics.html#running-order" class="sidebar-link">Running order</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#awaitable-objects" class="sidebar-link">Awaitable Objects</a></li></ul></li><li class="sidebar-sub-header"><a href="/python/Basics.html#garbage-collection" class="sidebar-link">Garbage collection</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#subprocess" class="sidebar-link">Subprocess</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#concurrent-parallel" class="sidebar-link">Concurrent &amp; Parallel</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#time" class="sidebar-link">Time</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/Basics.html#get" class="sidebar-link">Get</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#create" class="sidebar-link">Create</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#switch" class="sidebar-link">Switch</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#parser" class="sidebar-link">Parser</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#operation" class="sidebar-link">Operation</a></li></ul></li><li class="sidebar-sub-header"><a href="/python/Basics.html#ide" class="sidebar-link">IDE</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/Basics.html#pycharm" class="sidebar-link">Pycharm</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#conda" class="sidebar-link">Conda</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#pip" class="sidebar-link">pip</a></li></ul></li><li class="sidebar-sub-header"><a href="/python/Basics.html#yaml" class="sidebar-link">yaml</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/python/Basics.html#disable-alias" class="sidebar-link">Disable alias</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#partial-flow" class="sidebar-link">Partial flow</a></li><li class="sidebar-sub-header"><a href="/python/Basics.html#multiline" class="sidebar-link">Multiline</a></li></ul></li><li class="sidebar-sub-header"><a href="/python/Basics.html#miscellaneous" class="sidebar-link">Miscellaneous</a></li></ul></li><li><a href="/python/Web.html" class="sidebar-link">Web</a></li><li><a href="/python/NN.html" class="sidebar-link">Neural Networks</a></li><li><a href="/python/Test.html" class="sidebar-link">Test</a></li><li><a href="/python/PDF.html" class="sidebar-link">PDF</a></li><li><a href="/python/Coroutine.html" class="sidebar-link">Awaitable</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="basics"><a href="#basics" class="header-anchor">#</a> Basics</h1> <p style="color:red;">Quick reference to syntax usage. Please focus on system design, fundamental design of the language itself and algorithm.</p> <h2 id="loop"><a href="#loop" class="header-anchor">#</a> Loop</h2> <ol><li><p><code>range</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># 0 to 9</span>
<span class="token builtin">reversed</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 9 to 0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
i <span class="token operator">==</span> <span class="token number">9</span> <span class="token comment"># True</span>
</code></pre></div></li> <li><p><code>zip</code></p> <div class="custom-block tip"><p class="custom-block-title">Comparison between python 2 and 3</p> <p><code>python3</code>: zip returns an iterator.<br> <code>python2</code>: zip returns a list.</p></div> <div class="language-python extra-class"><pre class="language-python"><code><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># iterator of [(1,),(2,),(3,),(4,)]</span>
<span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [(1,),(2,),(3,),(4,)]</span>

<span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [(1,4),(2,5),(3,6)]</span>

<span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># [(1,1), (2,2,), (3,3)]</span>

itertools<span class="token punctuation">.</span>zip_longest<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> fillvalue<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment"># [(1,4),(2,5),(None, 6)]</span>
</code></pre></div></li></ol> <h2 id="string"><a href="#string" class="header-anchor">#</a> String</h2> <ol><li><p>format</p> <ol><li><p><code>%</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># number format</span>
<span class="token string">&quot;%.2f%%&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 33.33%, %% to escape</span>
<span class="token comment"># positive decimal means right alignment for both string and numbers</span>
<span class="token string">&quot;%6.2f&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">33.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;  33.33&quot; right align</span>
<span class="token string">&quot;%-6.2f&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">33.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;33.33  &quot; left align</span>
<span class="token string">&quot;%x&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">8217</span><span class="token punctuation">)</span> <span class="token comment"># 2019 decimal to hex</span>
<span class="token punctuation">(</span><span class="token string">&quot;%%%ds&quot;</span> <span class="token operator">%</span> length<span class="token punctuation">)</span> <span class="token operator">%</span> string <span class="token comment"># indention as parameter</span>
<span class="token string">&quot;%*s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>length<span class="token punctuation">,</span> string<span class="token punctuation">)</span>  <span class="token comment"># indention as parameter</span>

<span class="token comment"># dict format</span>
to_print <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'david'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">}</span>
<span class="token string">&quot;%(name)s, %(age)d&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>to_print<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>format</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;0.33&quot;</span>
<span class="token string">&quot;{0:.0%}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;33%&quot;</span>
<span class="token string">&quot;{0:.2f}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;0.33&quot;</span>
<span class="token string">&quot;{0:6.2f}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;  0.33&quot;</span>
<span class="token string">&quot;{0:&gt;6.2f}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;  0.33&quot;</span>
<span class="token string">&quot;{0:&lt;6.2f}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;0.33  &quot;</span>
<span class="token string">&quot;{:6.2f}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">0.33</span><span class="token punctuation">)</span> <span class="token comment"># &quot;  0.33&quot;</span>
<span class="token string">&quot;{:,.2f}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span> <span class="token comment"># &quot;1,234.00&quot;</span>

<span class="token comment"># string default left, numeric default right</span>
<span class="token string">&quot;{:8s}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">&quot;guagua&quot;</span><span class="token punctuation">)</span> <span class="token comment"># &quot;guagua  &quot;</span>
<span class="token string">&quot;{:&gt;8s}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">&quot;guagua&quot;</span><span class="token punctuation">)</span> <span class="token comment"># &quot;  guagua&quot;</span>
<span class="token string">'{1:&gt;{0}}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>length<span class="token punctuation">,</span> string<span class="token punctuation">)</span> <span class="token comment"># indention as parameter</span>

<span class="token string">&quot;{value}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

person <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;guagua&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span>
<span class="token string">&quot;{name}, {age}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token operator">**</span>person<span class="token punctuation">)</span>

<span class="token string">&quot;I &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;love &quot;</span> <span class="token operator">+</span>
<span class="token string">&quot;you&quot;</span>
</code></pre></div></li> <li><p><code>f</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>f-str is evaluated in runtime, so it is <strong>faster</strong><br> <code>\</code> is not allowed</p></div> <div class="language-python extra-class"><pre class="language-python"><code>name <span class="token operator">=</span> <span class="token string">&quot;guagua&quot;</span>
age <span class="token operator">=</span> <span class="token number">10</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token comment"># guagua,10.00</span>
<span class="token comment"># positive decimal not for justification</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">6f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># guagua,10.000000</span>
<span class="token comment"># positive decimal means right justified</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">6.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># guagua, 10.00</span>
<span class="token comment"># &gt; means right justified (default for numeric value)</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">&gt;6.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># guagua, 10.00</span>
<span class="token comment"># &lt; means left justified</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">&lt;6.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># guagua,10.00</span>
<span class="token comment"># &gt; means left justified (default for string)</span>
<span class="token string-interpolation"><span class="token string">f&quot;start:</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token format-spec">&gt;10s</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">6.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># start:    guagua, 10.00</span>
<span class="token comment"># - not working for left justification</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token format-spec">-6d</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># guagua,    10</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token punctuation">{</span>length<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># pass indention as variable</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token number">1234</span><span class="token punctuation">:</span><span class="token format-spec">,.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token comment"># guagua,1,234.00</span>

<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>func<span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token comment"># evaluation</span>

<span class="token string-interpolation"><span class="token string">f&quot;{{</span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string">}}&quot;</span></span> <span class="token comment"># {10}</span>

<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span> <span class="token punctuation">{</span>age<span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token comment"># {10}</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">&quot;111&quot;</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>a<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>a<span class="token punctuation">}</span></span><span class="token string"> hahah&quot;</span></span>
test <span class="token operator">=</span> Test
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>test<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token comment"># 111</span>
<span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>test<span class="token conversion-option punctuation">!r</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token comment"># 111 hahah</span>

<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;I &quot;</span></span>
 <span class="token string-interpolation"><span class="token string">f&quot;love &quot;</span></span>
 <span class="token string-interpolation"><span class="token string">f&quot;you&quot;</span></span><span class="token punctuation">)</span> <span class="token comment"># I love you, no + sign needed</span>

 <span class="token string-interpolation"><span class="token string">f&quot;I &quot;</span></span> \
 <span class="token string-interpolation"><span class="token string">f&quot;love &quot;</span></span> \
 <span class="token string-interpolation"><span class="token string">f&quot;you&quot;</span></span>
</code></pre></div></li></ol></li> <li><p>arabic</p> <p><a href="https://www.compart.com/en/unicode/bidiclass" target="_blank" rel="noopener noreferrer">Class of bi-direction<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> defines the display direction of a character.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>default <a href="https://www.w3.org/TR/WCAG20-TECHS/H34.html" target="_blank" rel="noopener noreferrer">bidi<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> text base direction in <em>python</em> and <em>js engine</em> are left-to-right. In <em>pycharm</em>, it is content-based. <em>vscode</em>'s terminal is problematic. The arabic string is treated as normal string.</p></div> <p>left-to-right base direction:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
1. arabic words display from right to left
2. alphabets display from left to right
3. base direction controls how words are connected
3. in left-to-right base direction, alphabets put at
existing text's right, even if the text is arabic
4. arabic word[number] put at right if existing is non-arabic, otherwise at left
5. \u200e, left to right mark, changes arabic[number] to be put at right
6. \u200f, right to left mart, changes arabic[number] to be put at left
7. \u202e + text + \u202c =&gt; txet
8. \u202e + arabic + \u202c =&gt; arabic
&quot;&quot;&quot;</span>
ar <span class="token operator">=</span> <span class="token string">'للصناعة'</span>

<span class="token comment"># existing is none, 123 as it is, 123|cursor--&gt;</span>
<span class="token comment"># existing is 123 with ltr, arabic word put at right</span>
<span class="token comment"># ar[0] = 'ل'</span>
<span class="token comment"># 123|cursor--&gt;'للصناعة'</span>
<span class="token string">'123'</span> <span class="token operator">+</span> ar <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'123للصناعة'</span>
<span class="token string">'abc'</span> <span class="token operator">+</span> ar <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'abcللصناعة'</span>

<span class="token comment"># ar[0] = 'ل'</span>
<span class="token comment"># ar:   &lt;--curser|'للصناعة'</span>
<span class="token comment"># existing is arabic, numbers[arabic] put at left</span>
<span class="token comment"># alphabets[punctuation] are always put at right</span>
<span class="token comment"># numbers: cursor--&gt;|'للصناعة'</span>
<span class="token comment"># alphabets: 'للصناعة'|cursor--&gt;</span>
ar <span class="token operator">+</span> <span class="token string">'123'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'للصناعة123'</span>
ar <span class="token operator">+</span> <span class="token string">'abc'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'للصناعةabc'</span>
ar <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'للصناعة\n'</span>

<span class="token string">'123'</span> <span class="token operator">+</span> ar <span class="token operator">+</span> <span class="token string">'456'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'123للصناعة456'</span>

<span class="token comment"># \u200e changes numbers to be put at right</span>
<span class="token comment"># numbers: 'للصناعة'|cursor--&gt;</span>
<span class="token string">'123'</span> <span class="token operator">+</span> ar <span class="token operator">+</span> <span class="token string">'\u200E'</span> <span class="token operator">+</span> <span class="token string">'456'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'123‎للصناعة‎456'</span>
</code></pre></div></li> <li><p>Encoding</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 'x': decimal to hex</span>
<span class="token string">'%04x'</span> <span class="token operator">%</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'我'</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">6211</span>
<span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">25105</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'我'</span>
<span class="token string">'我'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">b'\xe6\x88\x91'</span>

<span class="token comment"># \xef\xbb\xbf byte order mark to indicate utf-8 encoding schema</span>
<span class="token string">'我'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8-sig'</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">b'\xef\xbb\xbf\xe6\x88\x91'</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
\xfe\xff or \xff\xfe is byte order mark to indicate endian and encoding schema
if reads \xff\xfe, then python knows utf-16 is using little endian
if reads \xfe\xff, then python knows utf-16 is using big endian
in this case, utf-16 is using little endian
\u6211 in little endian: \x11\x62;
bytes \x62 in ascii is b
&quot;&quot;&quot;</span>
<span class="token string">'我'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-16'</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">b'\xff\xfe\x11b'</span>
<span class="token string">'我'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-16le'</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">b'\x11b'</span>
<span class="token string">'我'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-16be'</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">b'b\x11'</span>
</code></pre></div></li> <li><p>Raw string</p></li></ol> <p>raw strings are not 100% raw</p> <div class="language-python extra-class"><pre class="language-python"><code>r'\'  <span class="token comment"># error</span>
<span class="token string">r'\n'</span> <span class="token comment"># \n</span>
<span class="token string">r'\&quot;'</span>  <span class="token comment"># \&quot;</span>
<span class="token triple-quoted-string string">r'''123'''</span>'  <span class="token comment"># error</span>
<span class="token triple-quoted-string string">r'''12'3'''</span>  <span class="token comment"># 12'3</span>
</code></pre></div><ol><li>Common method</li></ol> <p>capitalize first letter: <code>st.title()</code></p> <h2 id="syntax-sugar"><a href="#syntax-sugar" class="header-anchor">#</a> Syntax sugar</h2> <ol><li><p><code>if else</code></p> <div class="language-python extra-class"><pre class="language-python"><code>x <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">if</span> a <span class="token operator">&gt;</span> b <span class="token keyword">else</span> <span class="token number">9</span>
<span class="token comment"># ternary operator(nested conditional assignment)</span>
sign <span class="token operator">=</span> <span class="token string">&quot;positive&quot;</span> <span class="token keyword">if</span> num <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">&quot;negative&quot;</span> <span class="token keyword">if</span> num <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">&quot;zero&quot;</span>

<span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token boolean">True</span> <span class="token keyword">if</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token boolean">False</span>

<span class="token punctuation">[</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> y <span class="token keyword">if</span> x<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token punctuation">[</span>x <span class="token keyword">if</span> x<span class="token operator">&gt;</span><span class="token number">10</span> <span class="token keyword">else</span> <span class="token number">5</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> y<span class="token punctuation">]</span>
</code></pre></div></li> <li><p><code>tuple</code></p> <div class="language-python extra-class"><pre class="language-python"><code>l <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span>  <span class="token comment"># initialized as (10,)</span>
</code></pre></div></li> <li><p><code>raw string</code></p> <div class="language-python extra-class"><pre class="language-python"><code>l <span class="token operator">=</span> r'\'  <span class="token comment"># single slash cannot be rawed</span>
l <span class="token operator">=</span> <span class="token string">'\\'</span>  <span class="token comment"># works</span>
l <span class="token operator">=</span> <span class="token string">r'\s'</span>  <span class="token comment"># \s</span>
l <span class="token operator">=</span> <span class="token string">'\\s'</span>  <span class="token comment"># \s</span>
</code></pre></div></li> <li><p><code>&amp;</code> and <code>|</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">}</span>

collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Counter<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> collections<span class="token punctuation">.</span>Counter<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Counter<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>sort by two keys</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token builtin">sorted</span><span class="token punctuation">(</span>a_list<span class="token punctuation">,</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>key1<span class="token punctuation">,</span> key2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>list concatenation</p> <div class="language-python extra-class"><pre class="language-python"><code>l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
l<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>  <span class="token comment"># [1, 2, 3]</span>
</code></pre></div></li> <li><p>one liner</p> <div class="language- extra-class"><pre class="language-text"><code>stmt: simple_stmt | compound_stmt
simple_stmt: small_stmt (';' small_stmt)* [';'] NEWLINE
</code></pre></div><p><code>;</code> to separate non-compound statements on a single line; the grammar makes no allowance for a non-compound statement and a compound statement separated by a semicolon.</p> <p>example with compound for statement:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>python -c $<span class="token string">'x=10<span class="token entity" title="\n">\n</span>for i in range(x): print(i)'</span>  <span class="token comment"># use \n to separate non-compound and compound</span>
</code></pre></div></li> <li><p><code>in</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">__contains__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> needle<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> elem <span class="token keyword">in</span> self<span class="token punctuation">:</span>
        <span class="token keyword">if</span> needle <span class="token keyword">is</span> elem <span class="token keyword">or</span> needle <span class="token operator">==</span> elem<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre></div></li></ol> <h2 id="error-handling"><a href="#error-handling" class="header-anchor">#</a> Error handling</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If the code in the except block raises an unhandled exception, the before-caught exception will be thrown again with the message format:</p> <div class="language- extra-class"><pre class="language-text"><code>original_exception

During handling of the above exception, another exception occurred

new_exception
</code></pre></div></div> <div class="language-python extra-class"><pre class="language-python"><code>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    code<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    code_throw_exception<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="regex"><a href="#regex" class="header-anchor">#</a> Regex</h2> <ol><li><p><code>re.sub</code></p> <div class="language-python extra-class"><pre class="language-python"><code>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r&quot;[^a-b]&quot;</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">&quot;mystring&quot;</span><span class="token punctuation">)</span>

re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'123\n456'</span><span class="token punctuation">)</span>  <span class="token comment"># 123456</span>
re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'123\n456'</span><span class="token punctuation">)</span>  <span class="token comment"># 123456, \n raw string is treated as new line in regex</span>
re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'\\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'123\n456'</span><span class="token punctuation">)</span>  <span class="token comment"># 123456, \n raw string is treated as new line in regex</span>

<span class="token comment"># returns '-a-b--d-'</span>
<span class="token comment"># Empty matches for the pattern are replaced when adjacent to a previous non-empty match</span>
<span class="token comment"># five matches due to * |a|bx|d|</span>
re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'x*'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'abxd'</span><span class="token punctuation">)</span>

re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">)</span>  <span class="token comment"># abc| =&gt; 123123</span>
</code></pre></div></li> <li><p><code>re.findall</code></p> <div class="language-python extra-class"><pre class="language-python"><code>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">&quot;dss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gddss&quot;</span><span class="token punctuation">)</span> <span class="token comment"># [&quot;dss&quot;], a list</span>
re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">&quot;dss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gdssdss&quot;</span><span class="token punctuation">)</span> <span class="token comment"># [&quot;dss&quot;, &quot;dss&quot;], a list</span>
re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">&quot;d(ss)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gddss&quot;</span><span class="token punctuation">)</span> <span class="token comment"># [&quot;ss&quot;], a list</span>
re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">&quot;(12)|(34)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123445&quot;</span><span class="token punctuation">)</span> <span class="token comment"># [('12', '34')]</span>
re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">&quot;(12)|(34)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123445&quot;</span><span class="token punctuation">)</span> <span class="token comment"># [('12', ''), ('', '34')]</span>

re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">&quot;d(ss)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gddss&quot;</span><span class="token punctuation">)</span> <span class="token comment"># a match group, where 0 is the full match(dss), group 1 is ss.</span>
re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">&quot;dss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gdssdss&quot;</span><span class="token punctuation">)</span> <span class="token comment"># only has group 0(dss)</span>

re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">&quot;dss&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gddss&quot;</span><span class="token punctuation">)</span> <span class="token comment"># None, re.match(&quot;dss&quot;) &lt;=&gt; re.search(&quot;^dss&quot;) avoiding using re.match</span>
</code></pre></div></li> <li><p><code>re.MULTILINE</code></p> <blockquote><p>if <code>^</code> in pattern, search every line<br>
invalid for <code>re.match</code></p></blockquote></li> <li><p><code>look</code></p> <p><strong>Order</strong></p> <ul><li><strong>behind -&gt; ahead</strong></li> <li>(?&lt;=abc)123: first find 123 then <strong>behind-looking</strong> abc</li></ul> <p><strong>Trivial pattern</strong></p> <ul><li><code>something(?&lt;=something)</code> and <code>(?=something)something</code> are trivial:
<ul><li><code>123(?&lt;=123)abc</code>, <code>123(?=abc)abc</code> (123abc)</li> <li><code>456(?&lt;=123)abc</code>(no matched string exists)</li> <li><code>re.search(&quot;^(?&lt;=abc)123&quot;)</code> or <code>re.match(&quot;(?&lt;=abc)123&quot;)</code> always matches nothing.</li></ul></li> <li>If look ahead has ahead, it must be look head's substring(or <code>.</code>). If look behind has behind, it must be look behind's substring.</li></ul> <p><strong>Flexibility</strong></p> <ul><li><code>(?=something)</code> and <code>(?!something)</code> are flexible: <code>something</code> can be any regex pattern</li> <li>lookahead supports or operation, but lookbehind doesn't(fix width jumping back to save speed)
<ul><li><p><code>^((?!123).)*$</code>: from start to end, as long as there is no 123 inside. (negative lookahead has flexible ahead)</p></li> <li><p><code>^((?!123|456).)*$</code>: from start to end, as long as there is no 123 <strong>nor</strong> 456 inside. (negative lookahead has flexible ahead)</p></li> <li><p><code>(?:(?&lt;=123)|(?&lt;=456))</code> 123 or 456</p></li> <li><p><code>(?&lt;!123)(?&lt;!456)</code> not 123 and 456</p></li></ul></li></ul></li> <li><p><code>\b</code></p> <p><code>\b</code> will only match if on one side there is a valid &quot;word&quot; character and on the other side not.</p> <blockquote><p><code>)\b</code> not matching <code>) word</code>, as <code>)</code>'s two sides are all non-word</p></blockquote> <blockquote><p><code>a\b</code> matching <code>a word</code></p></blockquote></li> <li><p>fuzzy match (from <code>regex</code> not <code>re</code>)</p> <p>Regex usually attempts an exact match, but sometimes an approximate, or “fuzzy”, match is needed, for those cases where the text being searched may contain errors in the form of inserted, deleted or substituted characters.</p> <p>A fuzzy regex specifies which types of errors are permitted, and, optionally, either the minimum and maximum or only the maximum permitted number of each type. (You cannot specify only a minimum.)</p> <p>The 3 types of error are:</p> <ul><li>Insertion, indicated by “i”</li> <li>Deletion, indicated by “d”</li> <li>Substitution, indicated by “s”</li></ul> <p>In addition, “e” indicates any type of error.</p> <p>The fuzziness of a regex item is specified between “{” and “}” after the item.</p> <p>Examples:</p> <ul><li><code>foo</code> match “foo” exactly</li> <li><code>(?:foo){i}</code> match “foo”, permitting insertions</li> <li><code>(?:foo){d}</code> match “foo”, permitting deletions</li> <li><code>(?:foo){s}</code> match “foo”, permitting substitutions</li> <li><code>(?:foo){i,s}</code> match “foo”, permitting insertions and substitutions</li> <li><code>(?:foo){e}</code> match “foo”, permitting errors</li></ul> <p>If a certain type of error is specified, then any type not specified will <strong>not</strong> be permitted.</p> <p>In the following examples I’ll omit the item and write only the fuzziness:</p> <ul><li><code>{d&lt;=3}</code> permit at most 3 deletions, but no other types</li> <li><code>{i&lt;=1,s&lt;=2}</code> permit at most 1 insertion and at most 2 substitutions, but no deletions</li> <li><code>{1&lt;=e&lt;=3}</code> permit at least 1 and at most 3 errors</li> <li><code>{i&lt;=2,d&lt;=2,e&lt;=3}</code> permit at most 2 insertions, at most 2 deletions, at most 3 errors in total, but no substitutions</li></ul> <p>It’s also possible to state the costs of each type of error and the maximum permitted total cost.</p> <p>Examples:</p> <ul><li><code>{2i+2d+1s&lt;=4}</code> each insertion costs 2, each deletion costs 2, each substitution costs 1, the total cost must not exceed 4</li> <li><code>{i&lt;=1,d&lt;=1,s&lt;=1,2i+2d+1s&lt;=4}</code> at most 1 insertion, at most 1 deletion, at most 1 substitution; each insertion costs 2, each deletion costs 2, each substitution costs 1, the total cost must not exceed 4</li></ul> <p>You can also use “&lt;” instead of “&lt;=” if you want an exclusive minimum or maximum.</p> <p>You can add a test to perform on a character that’s substituted or inserted.</p> <p>Examples:</p> <ul><li><code>{s&lt;=2:[a-z]}</code> at most 2 substitutions, which must be in the character set <code>[a-z]</code>.</li> <li><code>{s&lt;=2,i&lt;=3:\d}</code> at most 2 substitutions, at most 3 insertions, which must be digits.</li></ul> <p>By default, fuzzy matching searches for the first match that meets the given constraints. The <code>ENHANCEMATCH</code> flag will cause it to attempt to improve the fit (i.e. reduce the number of errors) of the match that it has found.</p> <p>The <code>BESTMATCH</code> flag will make it search for the best match instead.</p> <p>Further examples to note:</p> <ul><li><code>regex.search(&quot;(dog){e}&quot;, &quot;cat and dog&quot;)[1]</code> returns <code>&quot;cat&quot;</code> because that matches <code>&quot;dog&quot;</code> with 3 errors (an unlimited number of errors is permitted).</li> <li><code>regex.search(&quot;(dog){e&lt;=1}&quot;, &quot;cat and dog&quot;)[1]</code> returns <code>&quot; dog&quot;</code> (with a leading space) because that matches <code>&quot;dog&quot;</code> with 1 error, which is within the limit.</li> <li><code>regex.search(&quot;(?e)(dog){e&lt;=1}&quot;, &quot;cat and dog&quot;)[1]</code> returns <code>&quot;dog&quot;</code> (without a leading space) because the fuzzy search matches <code>&quot; dog&quot;</code> with 1 error, which is within the limit, and the <code>(?e)</code> then it attempts a better fit.</li></ul> <p>In the first two examples there are perfect matches later in the string, but in neither case is it the first possible match.</p> <p>The match object has an attribute <tt>fuzzy_counts</tt> which gives the total number of substitutions, insertions and deletions.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># A 'raw' fuzzy match:</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> regex.fullmatch<span class="token punctuation">(</span>r<span class="token string">&quot;(?:cats|cat){e&lt;=1}&quot;</span>, <span class="token string">&quot;cat&quot;</span><span class="token punctuation">)</span>.fuzzy_counts
<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 0 substitutions, 0 insertions, 1 deletion.</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># A better match might be possible if the ENHANCEMATCH flag used:</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> regex.fullmatch<span class="token punctuation">(</span>r<span class="token string">&quot;(?e)(?:cats|cat){e&lt;=1}&quot;</span>, <span class="token string">&quot;cat&quot;</span><span class="token punctuation">)</span>.fuzzy_counts
<span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># 0 substitutions, 0 insertions, 0 deletions.</span>
</code></pre></div><p>The match object also has an attribute <code>fuzzy_changes</code> which gives a tuple of the positions of the substitutions, insertions and deletions.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> m <span class="token operator">=</span> regex.search<span class="token punctuation">(</span><span class="token string">'(fuu){i&lt;=2,d&lt;=2,e&lt;=5}'</span>, <span class="token string">'anaconda foo bar'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> m
<span class="token operator">&lt;</span>regex.Match object<span class="token punctuation">;</span> <span class="token assign-left variable">span</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span>, <span class="token number">10</span><span class="token punctuation">)</span>, <span class="token assign-left variable">match</span><span class="token operator">=</span><span class="token string">'a f'</span>, <span class="token assign-left variable">fuzzy_counts</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">2</span>, <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> m.fuzzy_changes
<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token number">7</span>, <span class="token number">8</span><span class="token punctuation">]</span>, <span class="token punctuation">[</span><span class="token number">10</span>, <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>What this means is that if the matched part of the string had been:</p> <div class="language- extra-class"><pre class="language-text"><code>'anacondfuuoo bar'
</code></pre></div><p>it would’ve been an exact match.</p> <p>However, there were insertions at positions 7 and 8:</p> <div class="language- extra-class"><pre class="language-text"><code>'anaconda fuuoo bar'
        ^^
</code></pre></div><p>and deletions at positions 10 and 11:</p> <div class="language- extra-class"><pre class="language-text"><code>'anaconda f~~oo bar'
           ^^
</code></pre></div><p>So the actual string was:</p> <div class="language- extra-class"><pre class="language-text"><code>'anaconda foo bar'
</code></pre></div></li> <li><p><a href="https://www.regular-expressions.info/catastrophic.html" target="_blank" rel="noopener noreferrer">catastrophic backtracking<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'^(\W*K\W*)+$'</span><span class="token punctuation">,</span> <span class="token string">'K  K  K  K  K  K  K  K 6'</span><span class="token punctuation">)</span>  <span class="token comment"># leads to catastrophic, because 1st \W* &amp; 2nd \W* creates a lot of combinations</span>
re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'^(\W*K)+\W*$'</span><span class="token punctuation">,</span> <span class="token string">'K  K  K  K  K  K  K  K 6'</span><span class="token punctuation">)</span>  <span class="token comment"># no, because \W*K with little combinations</span>
</code></pre></div></li></ol> <h2 id="arithmetic"><a href="#arithmetic" class="header-anchor">#</a> Arithmetic</h2> <ol><li><code>**</code>, power</li> <li><code>val // num</code> =&gt; floor</li> <li><code>-(-val // num)</code> =&gt; ceil</li> <li><code>449027587.27 - 315000000 != 134027587.27</code> <code>from decimal import Decimal Decimal(449027587.27) - Decimal(315000000) == Decimal(134027587.27)</code></li> <li><code>**</code> &gt; <code>~x</code> &gt; <code>+x -x</code>&gt; <code>* , / , // , %</code> &gt; <code>+ -</code> &gt; <code>&lt;&lt;, &gt;&gt;</code> &gt; <code>&amp;</code> &gt; <code>^</code> &gt; <code>|</code> &gt; <code>!=, ==</code></li></ol> <h2 id="进制"><a href="#进制" class="header-anchor">#</a> 进制</h2> <ol><li>hex &lt;=&gt; decimal<div class="language-python extra-class"><pre class="language-python"><code><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment"># 0xc</span>
<span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span> <span class="token comment"># c(without '0x' proceeding)</span>
<span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">&quot;0xc&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token comment"># 12</span>
</code></pre></div></li> <li>bin &lt;=&gt; decimal<div class="language-python extra-class"><pre class="language-python"><code><span class="token builtin">bin</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment"># 0b1100</span>
<span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token comment"># 1100</span>
<span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">&quot;0b1100&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 12</span>
</code></pre></div></li></ol> <h2 id="list"><a href="#list" class="header-anchor">#</a> List</h2> <h3 id="basics-2"><a href="#basics-2" class="header-anchor">#</a> Basics</h3> <div class="language-python extra-class"><pre class="language-python"><code>l1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
l1<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
l1<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">+</span> l1

l1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
l1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">*</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">]</span> <span class="token comment"># [1,2,3,4,5,6]</span>

mixed_types <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="pydash"><a href="#pydash" class="header-anchor">#</a> pydash</h3> <ul><li><code>pydash.key_by</code> and <code>pydash.group_by</code> keep the references to original item</li> <li><code>pydash.key_by</code> and <code>pydash.group_by</code>'s <code>iteratee</code> evaluated to property if it is <code>.</code> delimited(True/False, if list with more than one item)</li> <li><code>pydash.get</code> accepts path in both <code>.</code> and list format</li></ul> <h2 id="logging"><a href="#logging" class="header-anchor">#</a> Logging</h2> <ol><li><p>levels</p> <ul><li>CRITICAL</li> <li>ERROR</li> <li>WARNING</li> <li>INFO</li> <li>DEBUG</li> <li>NOTSET</li></ul></li> <li><p>mechanism</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> logging
log <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;Hello, world&quot;</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>the message is turned into a <code>LogRecord</code> object and routed to a <code>Handler</code> object registered for this logger. The handler will then use a <code>Formatter</code> to turn the LogRecord into a string and emit that string.</p></blockquote></li> <li><p>lazy evaluation</p> <div class="language-python extra-class"><pre class="language-python"><code>logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'this is a debug message %s'</span><span class="token punctuation">,</span> var<span class="token punctuation">)</span>  <span class="token comment"># lazy evaluation(only if debug level)</span>

<span class="token comment"># always evaluation</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'this is a debug message </span><span class="token interpolation"><span class="token punctuation">{</span>var<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
logger<span class="token punctuation">.</span>debug<span class="token punctuation">(</span><span class="token string">'this is a debug message %s'</span> <span class="token operator">%</span> var<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>usage</p> <p><code>basicConfig</code>: initializes logging and adds a <code>Formatter</code> and a <code>Handler</code> to the root logger, if not exists. (<code>logging.info</code> will calls <code>basicConfig</code> internally if no handler available)</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> logging
<span class="token keyword">import</span> os

<span class="token comment"># exports to stderr</span>
<span class="token comment"># ERROR:the.module.name:The log message</span>
logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;LOGLEVEL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>OneLineExceptionFormatter</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> logging
<span class="token keyword">import</span> os

<span class="token keyword">class</span> <span class="token class-name">OneLineExceptionFormatter</span><span class="token punctuation">(</span>logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">formatException</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>formatException<span class="token punctuation">(</span>exc_info<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
        <span class="token keyword">if</span> record<span class="token punctuation">.</span>exc_text<span class="token punctuation">:</span>
            result <span class="token operator">=</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result

<span class="token comment"># default level for handler is NOTSET</span>
handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># BASIC_FORMAT = &quot;%(levelname)s:%(name)s:%(message)s&quot;</span>
formatter <span class="token operator">=</span> OneLineExceptionFormatter<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>BASIC_FORMAT<span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
<span class="token comment"># default level for logger is NOTSET</span>
<span class="token comment"># no name given, returns root logger</span>
root <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;LOGLEVEL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

<span class="token comment"># global try/catch</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
    <span class="token comment"># logging.exception == logging.error('', exc_info=True) == logging.error('', exc_info=False) + 'original exception stack trace, during handling another happen:' + print(traceback.format_exc())</span>
    <span class="token comment"># exc_info contains the stack trace</span>
    <span class="token comment"># if there is no other exception handler, output the</span>
    <span class="token comment"># stacktrace is okay. Otherwise, log the error with</span>
    <span class="token comment"># summary only, i.e.,</span>
    <span class="token comment"># logging.execption(exc_True=False)</span>
    logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span><span class="token string">&quot;Exception in main(): &quot;</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>ColoredLogger</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> logging

<span class="token keyword">class</span> <span class="token class-name">CustomFormatter</span><span class="token punctuation">(</span>logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Logging Formatter to add colors and count warning / errors&quot;&quot;&quot;</span>

    grey <span class="token operator">=</span> <span class="token string">&quot;\x1b[38;21m&quot;</span>
    yellow <span class="token operator">=</span> <span class="token string">&quot;\x1b[33;21m&quot;</span>
    red <span class="token operator">=</span> <span class="token string">&quot;\x1b[31;21m&quot;</span>
    bold_red <span class="token operator">=</span> <span class="token string">&quot;\x1b[31;1m&quot;</span>
    reset <span class="token operator">=</span> <span class="token string">&quot;\x1b[0m&quot;</span>
    <span class="token builtin">format</span> <span class="token operator">=</span> <span class="token string">&quot;%(asctime)s - %(name)s - %(levelname)s - %(message)s (%(filename)s:%(lineno)d)&quot;</span>

    FORMATS <span class="token operator">=</span> <span class="token punctuation">{</span>
        logging<span class="token punctuation">.</span>DEBUG<span class="token punctuation">:</span> grey <span class="token operator">+</span> <span class="token builtin">format</span> <span class="token operator">+</span> reset<span class="token punctuation">,</span>
        logging<span class="token punctuation">.</span>INFO<span class="token punctuation">:</span> grey <span class="token operator">+</span> <span class="token builtin">format</span> <span class="token operator">+</span> reset<span class="token punctuation">,</span>
        logging<span class="token punctuation">.</span>WARNING<span class="token punctuation">:</span> yellow <span class="token operator">+</span> <span class="token builtin">format</span> <span class="token operator">+</span> reset<span class="token punctuation">,</span>
        logging<span class="token punctuation">.</span>ERROR<span class="token punctuation">:</span> red <span class="token operator">+</span> <span class="token builtin">format</span> <span class="token operator">+</span> reset<span class="token punctuation">,</span>
        logging<span class="token punctuation">.</span>CRITICAL<span class="token punctuation">:</span> bold_red <span class="token operator">+</span> <span class="token builtin">format</span> <span class="token operator">+</span> reset
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">:</span>
        log_fmt <span class="token operator">=</span> self<span class="token punctuation">.</span>FORMATS<span class="token punctuation">.</span>get<span class="token punctuation">(</span>record<span class="token punctuation">.</span>levelno<span class="token punctuation">)</span>
        formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>log_fmt<span class="token punctuation">)</span>
        <span class="token keyword">return</span> formatter<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>

<span class="token comment"># default level for handler is NOTSET</span>
handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>StreamHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
formatter <span class="token operator">=</span> CustomFormatter<span class="token punctuation">(</span><span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
<span class="token comment"># default level for logger is NOTSET</span>
<span class="token comment"># no name given, returns root logger</span>
root <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;LOGLEVEL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

<span class="token comment"># global try/catch</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
    <span class="token comment"># logging.exception == logging.error('', exc_info=True)</span>
    <span class="token comment"># exc_info contains the stack trace</span>
    logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span><span class="token string">&quot;Exception in main(): &quot;</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Log to file</strong></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> logging
<span class="token keyword">import</span> logging<span class="token punctuation">.</span>handlers
<span class="token keyword">import</span> os

handler <span class="token operator">=</span> logging<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>WatchedFileHandler<span class="token punctuation">(</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;LOGFILE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/var/log/yourapp.log&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
formatter <span class="token operator">=</span> logging<span class="token punctuation">.</span>Formatter<span class="token punctuation">(</span>logging<span class="token punctuation">.</span>BASIC_FORMAT<span class="token punctuation">)</span>
handler<span class="token punctuation">.</span>setFormatter<span class="token punctuation">(</span>formatter<span class="token punctuation">)</span>
root <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>setLevel<span class="token punctuation">(</span>os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;LOGLEVEL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INFO&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
root<span class="token punctuation">.</span>addHandler<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

 <span class="token comment"># global try/catch</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    exit<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
    logging<span class="token punctuation">.</span>exception<span class="token punctuation">(</span><span class="token string">&quot;Exception in main()&quot;</span><span class="token punctuation">)</span>
    exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p><a href="https://docs.python.org/3.5/library/logging.config.html" target="_blank" rel="noopener noreferrer"><strong>load the logging configuration from a configuration file</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">disable_existing_loggers</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">formatters</span><span class="token punctuation">:</span>
    <span class="token key atrule">simple</span><span class="token punctuation">:</span>
        <span class="token key atrule">format</span><span class="token punctuation">:</span> <span class="token string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>
<span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token key atrule">console</span><span class="token punctuation">:</span>
        <span class="token key atrule">class</span><span class="token punctuation">:</span> logging.StreamHandler
        <span class="token key atrule">level</span><span class="token punctuation">:</span> INFO
        <span class="token key atrule">formatter</span><span class="token punctuation">:</span> simple
        <span class="token key atrule">stream</span><span class="token punctuation">:</span> ext<span class="token punctuation">:</span>//sys.stdout
    <span class="token key atrule">file</span><span class="token punctuation">:</span>
        <span class="token key atrule">class</span><span class="token punctuation">:</span> logging.FileHandler
        <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
        <span class="token key atrule">filename</span><span class="token punctuation">:</span> logs/dbInteract.log
<span class="token key atrule">loggers</span><span class="token punctuation">:</span>
    <span class="token comment"># They override the existing ones</span>
    <span class="token comment"># if disable_existing_loggers, the non-defined loggers won't work</span>
    <span class="token key atrule">simpleExample</span><span class="token punctuation">:</span>
        <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG
        <span class="token key atrule">handlers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>console<span class="token punctuation">]</span>
        <span class="token key atrule">propagate</span><span class="token punctuation">:</span> no
    <span class="token key atrule">root</span><span class="token punctuation">:</span>
        <span class="token key atrule">level</span><span class="token punctuation">:</span> DEBUG <span class="token comment"># loger level should be above/equal handler's level</span>
        <span class="token key atrule">handlers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>console<span class="token punctuation">,</span>file<span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> logging<span class="token punctuation">.</span>config
<span class="token keyword">import</span> yaml

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./test.yml'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> stream<span class="token punctuation">:</span>
    config <span class="token operator">=</span> yaml<span class="token punctuation">.</span>load<span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Loader<span class="token operator">=</span>yaml<span class="token punctuation">.</span>FullLoader<span class="token punctuation">)</span>

logging<span class="token punctuation">.</span>config<span class="token punctuation">.</span>dictConfig<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>remarks</p> <ul><li>When deploying to containers, try to keep things as simple as possible. Log to standard out/err and rely on your container host or orchestration platform to handle figuring out what to do with the logs</li> <li>exporting to stderr, pycharm will mark the messages as red</li> <li><code>gunicorn</code> adds additional handlers whereas <code>tensorflow</code> will not if a root logger already exists</li> <li>set up the logging sys after necessary packages are imported to take control of them</li> <li>to disable a specific package: <code>logging.getLogger('name').disabled = True</code></li> <li><code>logging.info</code> uses root logger</li> <li><code>logging.getLogger()</code> gets root logger</li></ul></li></ol> <h2 id="import"><a href="#import" class="header-anchor">#</a> import</h2> <div class="custom-block tip"><p class="custom-block-title">Background</p> <p>Module execution via import statement (i.e., <code>import &lt;modulename&gt;</code>):</p> <ul><li><code>sys.path</code> is not modified in any way</li> <li><code>__name__</code> is set to the absolute form of <code>&lt;modulename&gt;</code></li> <li><code>__package__</code> is set to the immediate parent package in <code>&lt;modulename&gt;</code></li> <li><code>__init__.py</code> is evaluated for all packages (including its own for package modules)</li> <li><code>__main__.py</code> is not evaluated for package modules; the code is evaluated for code modules</li></ul> <p>Module execution via command line with filename (i.e., <code>python &lt;filename&gt;</code>):</p> <ul><li><code>sys.path</code> is modified to include the final directory in <code>&lt;filename&gt;</code></li> <li><code>__name__</code> is set to <code>__main__</code></li> <li><code>__package__</code> is set to <code>None</code></li> <li><code>__init__.py</code> is not evaluated for any package (including its own for package modules)</li> <li><code>__main__.py</code> is evaluated for package modules; the code is evaluated for code modules</li></ul> <p>Module execution via command line with modulename (i.e., <code>python -m &lt;modulename&gt;</code>):</p> <ul><li><code>sys.path</code> is modified to include the current directory</li> <li><code>__name__</code> is set to <code>__main__</code></li> <li><code>__package__</code> is set to the immediate parent package in<code>&lt;modulename&gt;</code></li> <li><code>__init__.py</code> is evaluated for all packages (including its own for package modules)</li> <li><code>__main__.py</code> is evaluated for package modules; the code is evaluated for code modules</li></ul></div> <ol><li><p>import steps</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
project structure
/usr/test(root):
- app.py             # __package__ is ''
- another_app.py     # __package__ is ''
- moduleA(pakcage):
    - class_a.py     # __package__ is moduleA
    - class_b.py     # __package__ is moduleA
&quot;&quot;&quot;</span>
</code></pre></div><ol><li>resolve relative steps: if there is <code>from .xx import yy</code> or <code>from ..xx import yy</code> etc, using <code>__package__</code> to resolve. <code>__package__</code> might be None, empty string or the package name. Different modules(files) can have different <code>__package__</code> in the same python run. Modules at root folder have empty string as <code>__package__</code>, and other moduels have their package residing in as <code>__package__</code>. Note that if python program is run as a script(without -m), <code>__package__</code> becomes None, so relative imports will not work.<div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
app.py
&quot;&quot;&quot;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'__package__ is </span><span class="token interpolation"><span class="token punctuation">{</span>__package__<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
another_app.py
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> app

<span class="token triple-quoted-string string">&quot;&quot;&quot;
class_a.py
&quot;&quot;&quot;</span>
<span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">import</span> app
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># case 1</span>
<span class="token comment"># If a module(file) is at root, or top-level, __package__ is empty string</span>
<span class="token punctuation">(</span>/user/test<span class="token punctuation">)</span> $ python -m another_app
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> __package__ is <span class="token string">''</span>

<span class="token comment"># case 2</span>
<span class="token comment"># when a top-level module is run as the entry point as with -m, __package__ is empty string</span>
<span class="token punctuation">(</span>/usr/test<span class="token punctuation">)</span> $ python -m app
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> __package__ is <span class="token string">''</span>

<span class="token comment"># case 3</span>
<span class="token comment"># number of dots cannot exceed number of packages in __package__</span>
<span class="token comment"># class_a has 1 level package: moduleA, so .. does not work</span>
<span class="token punctuation">(</span>/usr/test<span class="token punctuation">)</span> $ python -m moduleA.class_a
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ValueError: attempted relative <span class="token function">import</span> beyond top-level package
<span class="token comment"># to make it work, switch root to /usr and make __package__ for class_a.py as test.moduleA</span>
<span class="token punctuation">(</span>/usr<span class="token punctuation">)</span> $ python -m test.moduelA.class_a
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> __package__ is <span class="token builtin class-name">test</span>

<span class="token comment"># case 4</span>
<span class="token comment"># if run the program as scripts, i.e., without -m, __package__ is None</span>
<span class="token punctuation">(</span>/usr/test<span class="token punctuation">)</span> $ python app.py
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> __package__ is None
</code></pre></div></li> <li>search from <code>sys.path</code><div class="language-python extra-class"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
class_a.py
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> sys
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'sys.path is </span><span class="token interpolation"><span class="token punctuation">{</span>sys<span class="token punctuation">.</span>path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># the directory containing the script, i.e., /usr/test/moduleA</span>
<span class="token punctuation">(</span>/usr/test<span class="token punctuation">)</span> $ python moduleA/class_a.py
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sys.path is /usr/test/moduleA

<span class="token comment"># current directory, i.e., /usr/test</span>
<span class="token punctuation">(</span>/usr/test<span class="token punctuation">)</span> $ python -m moduelA.class_a
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> sys.path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> is /usr/test

<span class="token comment"># interactive shell</span>
<span class="token punctuation">(</span>/usr/test<span class="token punctuation">)</span> $ python
~~~ <span class="token function">import</span> sys
~~~ sys.path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token string">''</span>
</code></pre></div></li></ol></li> <li><p><code>__init__.py</code></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Since <strong>python3.3</strong>, an empty <code>__init__.py</code> is no longer needed to mark a folder as python package</p></div> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># moduleA's __init__.py is run</span>
<span class="token keyword">from</span> app<span class="token punctuation">.</span>moduleA <span class="token keyword">import</span> method
<span class="token keyword">import</span> app<span class="token punctuation">.</span>moduleA

<span class="token comment"># moduleA's __init__.py is not run</span>
<span class="token keyword">import</span> app<span class="token punctuation">.</span>moduleA<span class="token punctuation">.</span>method
</code></pre></div></li> <li><p>Reloading</p> <p>After code changes, running code is outdated, but error code referenced in stack trace is updated</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> importlib
<span class="token comment"># only module can be reloaded</span>
importlib<span class="token punctuation">.</span><span class="token builtin">reload</span><span class="token punctuation">(</span>com<span class="token punctuation">.</span>package<span class="token punctuation">.</span>module<span class="token punctuation">)</span>

<span class="token keyword">from</span> com<span class="token punctuation">.</span>package<span class="token punctuation">.</span>module <span class="token keyword">import</span> method
</code></pre></div></li> <li><p>Variable control</p> <p><code>__all__</code> variable controls what can be imported by <code>from x import *</code></p></li> <li><p>Miscellaneous</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> A<span class="token punctuation">.</span>B<span class="token punctuation">.</span>C <span class="token keyword">import</span> D
<span class="token keyword">from</span> B<span class="token punctuation">.</span>C <span class="token keyword">import</span> D  <span class="token comment"># suppose A in added in PYTHONPATH</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
Modify variables inside 1st D will not change those inside 2nd D, since __package__ of two Ds are different
&quot;&quot;&quot;</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> A
A<span class="token punctuation">.</span>B  <span class="token comment"># error as sub module cannot be accessed if not imported</span>
<span class="token keyword">import</span> A<span class="token punctuation">.</span>B  <span class="token comment"># okay</span>
</code></pre></div></li></ol> <h2 id="oop"><a href="#oop" class="header-anchor">#</a> OOP</h2> <ol><li><p><code>is</code> used to check if two variables refer to the same object</p></li> <li><p><code>self</code> has access to class variables, but read-only:</p> <ul><li>recommends to get access to class methods using <code>self</code> for simplicity</li> <li>recommends to get access to class variables using <code>type(self)</code> instead of <code>self.__class__</code></li></ul> <div class="custom-block warning"><p class="custom-block-title">Comparison `type(self)` with `self.__class__`</p> <p><code>type()</code> is the same as <code>__class__</code> in python3<br>
in python2, if a class has no inheritance, only <code>__class__</code> works</p></div></li> <li><p>child has access to parent's overridden method</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>Bar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">baz</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># method implementation is from parent, but self refers to child</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>baz<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>child has access to grandparent's overridden method</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span>Cha<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Bar<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>Bar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">chz</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># method implementation is from grandparent, but self refers to child</span>
        <span class="token comment"># note the 1st argument of super is Bar instead of Foo</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>Bar<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>chz<span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>type</code></p> <p>type of a class is type if no custom metaclass is given</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">PythonBlog</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">PythonBlogSon</span><span class="token punctuation">(</span>PythonBlog<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token builtin">type</span><span class="token punctuation">(</span>PythonBlog<span class="token punctuation">)</span>  <span class="token comment"># type</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>PythonBlogSon<span class="token punctuation">)</span>  <span class="token comment"># type</span>

<span class="token keyword">class</span> <span class="token class-name">PythonBlog</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>MyMeta<span class="token punctuation">)</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">PythonBlogSon</span><span class="token punctuation">(</span>PythonBlog<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token builtin">type</span><span class="token punctuation">(</span>PythonBLog<span class="token punctuation">)</span>  <span class="token comment"># MyMeta</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>PythonBlogSon<span class="token punctuation">)</span>  <span class="token comment"># MyMeta</span>
</code></pre></div></li> <li><p><code>__new__</code></p> <p>rarely used</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Eel</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    MAX_EELS <span class="token operator">=</span> <span class="token number">20</span>
    n_eels <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment"># memory allocation and static variable manipulation</span>
    <span class="token comment"># called to create an instance</span>
    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> cls<span class="token punctuation">.</span>n_eels <span class="token operator">==</span> cls<span class="token punctuation">.</span>MAX_EELS<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> HovercraftFull<span class="token punctuation">(</span><span class="token punctuation">)</span>
        obj <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>Eel<span class="token punctuation">,</span> cls<span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>
        cls<span class="token punctuation">.</span>n_eels <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> obj
</code></pre></div></li> <li><p><code>__call__</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">Goo</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

Foo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># __init__ is called</span>

goo <span class="token operator">=</span> Goo<span class="token punctuation">(</span><span class="token punctuation">)</span>
goo<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># __call__ is called</span>


<span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    _instances <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> cls <span class="token keyword">not</span> <span class="token keyword">in</span> cls<span class="token punctuation">.</span>_instances<span class="token punctuation">:</span>
            cls<span class="token punctuation">.</span>_instances<span class="token punctuation">[</span>cls<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>Singleton<span class="token punctuation">,</span> cls<span class="token punctuation">)</span><span class="token punctuation">.</span>__call__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>_instances<span class="token punctuation">[</span>cls<span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span>metaclass<span class="token operator">=</span>Singleton<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre></div></li> <li><p><code>__dict__</code></p> <p>stores class attributes for class and instance attributes for instance</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span>

    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">10</span>


<span class="token triple-quoted-string string">&quot;&quot;&quot;
mappingproxy({'__module__': '__main__',
            '__init__': &lt;function __main__.Test.__init__(self)&gt;,
            'execute': &lt;function __main__.Test.execute(self)&gt;,
            '__dict__': &lt;attribute '__dict__' of 'Test' objects&gt;,
            '__weakref__': &lt;attribute '__weakref__' of 'Test' objects&gt;,
            '__doc__': None})
&quot;&quot;&quot;</span>
Test<span class="token punctuation">.</span>__dict__

Test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__dict__  <span class="token comment"># {'a': 10}</span>
</code></pre></div></li> <li><p><code>__wrapped__</code></p> <p>get access to wrapped underlying function</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> functools

<span class="token keyword">class</span> <span class="token class-name">Memoize</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>func <span class="token operator">=</span> func
        self<span class="token punctuation">.</span>memo <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># update __module__, __name__, __qualname__, __annotations__ and __doc__</span>
        <span class="token comment"># no update on __dict__</span>
        functools<span class="token punctuation">.</span>update_wrapper<span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">,</span> updated<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> args <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>memo<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>memo<span class="token punctuation">[</span>args<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>func<span class="token punctuation">(</span>args<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;cls decorator. You have printed this before&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>memo<span class="token punctuation">[</span>args<span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">CallCounter</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>func <span class="token operator">=</span> func
        self<span class="token punctuation">.</span>calls <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># update __module__, __name__, __qualname__, __annotations__ and __doc__</span>
        <span class="token comment"># update __dict__, i.e., {**self.__dict__, **wrapped.__dict__}</span>
        functools<span class="token punctuation">.</span>update_wrapper<span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>calls <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@Memoize</span>
<span class="token decorator annotation punctuation">@CallCounter</span>
<span class="token keyword">def</span> <span class="token function">doubleprint</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> elem <span class="token keyword">in</span> x<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>elem <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> elem<span class="token punctuation">)</span>

doubleprint  <span class="token comment"># Memoize at 0x7fa8034edcc0</span>
doubleprint<span class="token punctuation">.</span>__wrapped__  <span class="token comment"># CallCounter at 0x7fa8019540b8</span>
doubleprint<span class="token punctuation">.</span>__wrapped__<span class="token punctuation">.</span>__wrapped__  <span class="token comment"># function itself</span>
</code></pre></div></li> <li><p><code>__eq__</code> and <code>__hash__</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Number</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>number <span class="token operator">=</span> number

    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Overrides the default implementation&quot;&quot;&quot;</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>other<span class="token punctuation">,</span> Number<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>number <span class="token operator">==</span> other<span class="token punctuation">.</span>number

        <span class="token comment"># swap to other's __eq__</span>
        <span class="token keyword">return</span> NotImplemented

    <span class="token comment"># must return int</span>
    <span class="token keyword">def</span> <span class="token function">__hash__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Overrides the default implementation&quot;&quot;&quot;</span>
        <span class="token keyword">return</span> <span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

n1 <span class="token operator">=</span> Number<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
o1 <span class="token operator">=</span> Other<span class="token punctuation">(</span><span class="token string">'other'</span><span class="token punctuation">)</span>

<span class="token comment"># first try n1 then o1's __eq__, if Other is not a subclass of Number</span>
<span class="token comment"># first try 01 then n1's __eq__, if Other is a subclass of Number</span>
n1 <span class="token operator">==</span> o1
</code></pre></div></li> <li><p>staticmethod is inherited</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
<span class="token decorator annotation punctuation">@staticmethod</span>
<span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>

B<span class="token punctuation">.</span>a<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># A</span>
</code></pre></div></li> <li><p>method resolution order</p> <p>definition</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Child</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># determines method resolution order</span>
    <span class="token keyword">def</span> <span class="token function">method</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> arg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        child methods(including __init__ and other methods) follow method resolution order, i.e., mro. Note that mro can be both disconnected and connected:
        1. Disconnected mro: if there is no super().method(arg) in a class, method resolution is broken out as soon as this class's method call is finished
        2. Connected mro: if for every class excluding object, there is always a super().method(arg), methods in every generation are called
        &quot;&quot;&quot;</span>
        <span class="token comment"># super().method(arg) equivalence</span>
        mro <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>mro<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> next_class <span class="token keyword">in</span> mro<span class="token punctuation">[</span>mro<span class="token punctuation">.</span>index<span class="token punctuation">(</span>Child<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token comment"># slice to end</span>
            <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>next_class<span class="token punctuation">,</span> <span class="token string">'method'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                next_class<span class="token punctuation">.</span>method<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
</code></pre></div><p>mro examples</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#  mro example I</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">ChildB</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">Grandchild</span><span class="token punctuation">(</span>ChildA<span class="token punctuation">,</span> ChildB<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

Grandchild<span class="token punctuation">.</span>__mro__  <span class="token comment"># mro: (Grandchild, ChildA, ChildB, Parent, object)</span>

<span class="token comment"># mro example II</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;initializing Parent&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
if a class in mro misses the method, that class is skipped
&quot;&quot;&quot;</span>
a <span class="token operator">=</span> ChildA<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># skips ChildA, and Parent's __init__ is called</span>
a<span class="token punctuation">.</span>x  <span class="token comment"># 10</span>

<span class="token comment"># mro example III</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing Parent'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">gg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Parent!'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing ChildA'</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
mro for both __init__ and gg are both [ChildA, Parent]

execution order of __init__: ChildA starts, ChildA ends
execution order of gg: ChildA skips (no gg), Parent starts, Parent ends
&quot;&quot;&quot;</span>
a <span class="token operator">=</span> ChildA<span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>gg<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># works</span>
a<span class="token punctuation">.</span>x  <span class="token comment"># error</span>

<span class="token comment"># mro example IV</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing Parent'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing ChildA'</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ChildB</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing ChildB'</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Grandchild</span><span class="token punctuation">(</span>ChildA<span class="token punctuation">,</span> ChildB<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
connected mro in __init__ method

mro is G, A, B, Parent

execution order:
G skips (as there is no __init__ method)
A starts
B starts
Parent starts
Parent ends
B ends
A ends

execution result:
initializing ChildA
initializing ChildB
initializing Parent
&quot;&quot;&quot;</span>
Grandchild<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># mro example V</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing Parent'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing ChildA'</span><span class="token punctuation">)</span>
        <span class="token comment"># Parent.__init__(self) exists and miss super().__init__(), mro of __init__ becomes disconnected</span>
        Parent<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ChildB</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'initializing ChildB'</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Grandchild</span><span class="token punctuation">(</span>ChildA<span class="token punctuation">,</span> ChildB<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
disconnected mro in __init__ method

mro is G, A, B, Parent

execution order:
G skips (as there is no __init__ method)
A starts
Parent starts
Parent ends
A ends

execution result:
initializing ChildA
initializing Parent
&quot;&quot;&quot;</span>
Grandchild<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># mro example VI</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">gg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Parent!'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ChildA</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">class</span> <span class="token class-name">ChildB</span><span class="token punctuation">(</span>Parent<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">gg</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Child B!'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Grandchild</span><span class="token punctuation">(</span>ChildA<span class="token punctuation">,</span> ChildB<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
disconnected mro in gg method

mro is G, A, B, Parent

execution order:
G skips (as there is no gg method)
A skips (as there is no gg method)
B starts
B ends

execution result:
Child B!
&quot;&quot;&quot;</span>
g <span class="token operator">=</span> Grandchild<span class="token punctuation">(</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span>gg<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>Enum</code></p> <p>An enumeration is a set of symbolic names (members) bound to unique, constant values</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum

<span class="token keyword">class</span> <span class="token class-name">TestEnum</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">0</span>
    b <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> <span class="token number">0</span>
    b <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment"># Enum is iterable</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>TestEnum<span class="token punctuation">)</span>  <span class="token comment">#[&lt;TestEnum.a: 0&gt;, &lt;TestEnum.b: 1&gt;]</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>Test<span class="token punctuation">)</span>  <span class="token comment"># error</span>

<span class="token comment"># Enum has value and name</span>
TestEnum<span class="token punctuation">.</span>a  <span class="token comment"># &lt;enum 'TestEnum'&gt;</span>
Test<span class="token punctuation">.</span>a  <span class="token comment"># 0</span>
TestEnum<span class="token punctuation">.</span>a<span class="token punctuation">.</span>value  <span class="token comment"># 0</span>
Test<span class="token punctuation">.</span>a<span class="token punctuation">.</span>value  <span class="token comment"># error</span>
TestEnum<span class="token punctuation">.</span>a<span class="token punctuation">.</span>name  <span class="token comment"># a</span>
Test<span class="token punctuation">.</span>a<span class="token punctuation">.</span>value  <span class="token comment"># error</span>

<span class="token comment"># Enum is unassign-able</span>
TestEnum<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span>  <span class="token comment"># error</span>
Test<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">10</span>
</code></pre></div><p>Enum values can be functions</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> functools
<span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum

<span class="token keyword">class</span> <span class="token class-name">Wrapper</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>f <span class="token operator">=</span> f
        <span class="token comment"># update __module__, __name__, __qualname__, __annotations__ and __doc__</span>
        <span class="token comment"># update __dict__</span>
        functools<span class="token punctuation">.</span>update_wrapper<span class="token punctuation">(</span>self<span class="token punctuation">,</span> f<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>c<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>function<span class="token punctuation">.</span>__repr__<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">fa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'A'</span>

<span class="token keyword">class</span> <span class="token class-name">TestEnum</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># make a as an attribute instead of method definition</span>
    a <span class="token operator">=</span> Wrapper<span class="token punctuation">(</span>fa<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

TestEnum<span class="token punctuation">.</span>a<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 'A'</span>
</code></pre></div><p>Enum values can be class</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum

<span class="token keyword">class</span> <span class="token class-name">CA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name

    <span class="token keyword">def</span> <span class="token function">execute</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'A'</span>

<span class="token keyword">class</span> <span class="token class-name">TestEnum</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a  <span class="token operator">=</span> CA
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

TestEnum<span class="token punctuation">.</span>a<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 'A'</span>
</code></pre></div></li></ol> <h2 id="pickle"><a href="#pickle" class="header-anchor">#</a> Pickle</h2> <h3 id="general"><a href="#general" class="header-anchor">#</a> general</h3> <div class="custom-block warning"><p class="custom-block-title">Pickle of spacy.tokenizer.Tokenizer</p> <p>After loading, <code>Tokenizer</code> will call <code>token_match</code> method, hence there should not be any dependency inside <code>token_match</code> on variables which are restored later than <code>Tokenizer</code></p></div> <p><code>dump</code>: might call <code>__getstate__</code> or <code>__reduce__</code></p> <p><code>load</code>: might call <code>__new__</code> or <code>__setstate</code></p> <p>Pickable objects after un-pickling are guarenteed to have the same value, but might produce different <code>dump</code> value from its original <code>dump</code>: <a href="https://stackoverflow.com/a/7501980" target="_blank" rel="noopener noreferrer">link<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="cannot-pickle"><a href="#cannot-pickle" class="header-anchor">#</a> Cannot pickle</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> functools
<span class="token keyword">import</span> pickle

<span class="token keyword">def</span> <span class="token function">decorate</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

<span class="token decorator annotation punctuation">@decorate</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Pickle serializes only metadata about the function and then restores it from a code. But at this point hydra's main wrapper already has overwritten main function, so pickled function does not match function that it tries to restore

    Traceback (most recent call last):
    ...
    _pickle.PicklingError: Can't pickle &lt;function main at 0x7ff1df907ee0&gt;: it's not the same object as __main__.main
    &quot;&quot;&quot;</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="exec-vs-eval"><a href="#exec-vs-eval" class="header-anchor">#</a> exec vs eval</h2> <p><code>exec(&quot;&quot;, scope)</code>: always return None. <code>print</code> or <code>import</code> takes side effect</p> <p><code>eval</code>: accepts expression only. assignment or statement(like if) are rejected</p> <h2 id="closure"><a href="#closure" class="header-anchor">#</a> Closure</h2> <p>function with environment</p> <div class="custom-block tip"><p class="custom-block-title">Scope</p> <p><code>nonlocal</code> and <code>global</code> are keywords that control variable scope. Note that a variable created in the main body of the Python code is a global variable and belongs to the global scope.</p></div> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">generate_counter2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">add_one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># By making x non-local, Python finds it in the parent context and creates a closure for it again.</span>
        <span class="token keyword">nonlocal</span> x
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">return</span> x
    <span class="token keyword">return</span> add_one

<span class="token comment"># closure = generate_counter2()</span>
<span class="token comment"># closure.__closure__ =&gt; address 1</span>
<span class="token comment"># closure()</span>
<span class="token comment"># closure.__closure__ =&gt; address 2</span>
</code></pre></div><h2 id="yield"><a href="#yield" class="header-anchor">#</a> Yield</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> some_fn<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> manager<span class="token punctuation">:</span>
        <span class="token keyword">yield</span> something

g <span class="token operator">=</span> gen<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>  <span class="token comment"># manager has not exited yet</span>
<span class="token builtin">next</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>  <span class="token comment"># goes outside with, and manager got exited</span>

<span class="token keyword">def</span> <span class="token function">flatten</span><span class="token punctuation">(</span>sequence<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;flatten a multi level list or something
    &gt;&gt;&gt; list(flatten([1, [2], 3]))
    [1, 2, 3]
    &gt;&gt;&gt; list(flatten([1, [2], [3, [4]]]))
    [1, 2, 3, 4]
    &quot;&quot;&quot;</span>
    <span class="token keyword">for</span> element <span class="token keyword">in</span> sequence<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">'__iter__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token keyword">from</span> flatten<span class="token punctuation">(</span>element<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> element


<span class="token keyword">def</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;A coroutine that writes data *sent* to it to fd, socket, etc.&quot;&quot;&quot;</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            w <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">yield</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'&gt;&gt; '</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span>
        <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Close generator!'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">writer_wrapper</span><span class="token punctuation">(</span>sub_generator<span class="token punctuation">)</span>
    <span class="token comment"># it establishes a transparent bidirectional connection between the caller and the sub-generator</span>
    <span class="token keyword">yield</span> <span class="token keyword">from</span> sub_generator
w <span class="token operator">=</span> writer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">next</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span>
w<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'data1'</span><span class="token punctuation">)</span>
w<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'data2'</span><span class="token punctuation">)</span>
w<span class="token punctuation">.</span>throw<span class="token punctuation">(</span>StopIteration<span class="token punctuation">)</span>

w <span class="token operator">=</span> writer<span class="token punctuation">(</span><span class="token punctuation">)</span>
w_wrapper <span class="token operator">=</span> writer_wrapper<span class="token punctuation">(</span>w<span class="token punctuation">)</span>
<span class="token builtin">next</span><span class="token punctuation">(</span>w_wrapper<span class="token punctuation">)</span>
w_wrapper<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'data1'</span><span class="token punctuation">)</span>
w_wrapper<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'data2'</span><span class="token punctuation">)</span>
w_wrapper<span class="token punctuation">.</span>throw<span class="token punctuation">(</span>StopIteration<span class="token punctuation">)</span>
</code></pre></div><h2 id="coroutine-and-future"><a href="#coroutine-and-future" class="header-anchor">#</a> Coroutine and Future</h2> <div class="custom-block warning"><p class="custom-block-title">Coroutine</p> <p>There are two types of coroutines. The native coroutine and legacy generator based coroutine. The legacy coroutine is going to be removed in python 3.11</p></div> <p>Native coroutine is with <code>async</code>/<code>await</code> syntax. It is executed only when it is <code>await</code>ed</p> <p>Generator based coroutine is a old way in python 3.5 to create coroutine. It is with the syntac <code>@asyncio.coroutine</code> / <code>yield from</code>. <code>@asyncio.coroutine</code> enables the generator use <code>yield from</code> to call native coroutines, and also enables the generator to be called by native coroutines, for instance using an <code>await</code> expression. There is another decaroter <code>@types.coroutine</code> does the same thing except a <a href="https://stackoverflow.com/a/49477233/6845273" target="_blank" rel="noopener noreferrer">little difference<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">b_sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">100</span>

<span class="token decorator annotation punctuation">@asyncio<span class="token punctuation">.</span>coroutine</span>
<span class="token keyword">def</span> <span class="token function">a_sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;doing something in async&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token keyword">from</span> b_sleep<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># yield from native coroutine or generator based coroutine</span>

<span class="token decorator annotation punctuation">@asyncio<span class="token punctuation">.</span>coroutine</span>
<span class="token keyword">def</span> <span class="token function">a_sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;doing something in async&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">yield</span>  <span class="token comment"># yield None</span>

<span class="token keyword">await</span> a_sleep<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>asyncio</code> can generate <code>Future</code>s, which are scheduled to run by event loop regardless of <code>await</code>.</p> <h3 id="running-order"><a href="#running-order" class="header-anchor">#</a> Running order</h3> <p>If there is no <code>yield</code> control to event loop, the running order is the same as <code>await</code> order. If there is <code>yield</code> control to event loop, <code>Future</code>s can be executed immediately.</p> <p>To <code>yield</code> control to event loop:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># yield None</span>
<span class="token decorator annotation punctuation">@types<span class="token punctuation">.</span>coroutine</span>
<span class="token keyword">def</span> <span class="token function">__sleep0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span>
<span class="token keyword">await</span> __sleep0<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># yield Future</span>
<span class="token keyword">await</span> future
</code></pre></div><p><a href="https://stackoverflow.com/a/59780868/6845273" target="_blank" rel="noopener noreferrer">Details1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and Details2[https://github.com/python/cpython/blob/febf54bcf3fdc45ad84b4073e24bbaaee0ac8b2a/Lib/asyncio/tasks.py#L255] on <code>yield</code> control</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">p</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token punctuation">{</span>word<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coro <span class="token operator">=</span> p<span class="token punctuation">(</span><span class="token string">'await'</span><span class="token punctuation">)</span>
    task2 <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>p<span class="token punctuation">(</span><span class="token string">'create_task2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># scheduled to next iteration</span>
    <span class="token keyword">await</span> coro  <span class="token comment"># run coro only await</span>
    <span class="token keyword">await</span> task2 <span class="token comment"># wait for final result</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coro <span class="token operator">=</span> p<span class="token punctuation">(</span><span class="token string">'await'</span><span class="token punctuation">)</span>
    task2 <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>p<span class="token punctuation">(</span><span class="token string">'create_task2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># scheduled to next iteration</span>
    task3 <span class="token operator">=</span> loop<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>p<span class="token punctuation">(</span><span class="token string">'create_task3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># scheduled to next iteration</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># loop got control, and runs task2 and task 3</span>
    <span class="token keyword">await</span> coro  <span class="token comment"># run coro only await</span>
    <span class="token keyword">await</span> task2 <span class="token comment"># wait for final result</span>
    <span class="token keyword">await</span> task3 <span class="token comment"># wait for final result</span>


<span class="token comment"># await &gt; task2</span>
<span class="token keyword">await</span> main1<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># task2 &gt; task3 &gt; await</span>
<span class="token keyword">await</span> main2<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="awaitable-objects"><a href="#awaitable-objects" class="header-anchor">#</a> Awaitable Objects</h3> <p>An awaitable object generally implements an <code>__await__()</code> method. Coroutine objects returned from <code>async def</code> functions are awaitable. The generator iterator objects returned from generators decorated with <code>types.coroutine()</code> or <code>asyncio.coroutine()</code> are also awaitable, but they do not implement <code>__await__()</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyObject</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__await__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Must return an iterator</span>
        <span class="token keyword">yield</span> <span class="token keyword">from</span> a_future <span class="token comment"># marks __await__ as an iterator</span>
</code></pre></div><h2 id="garbage-collection"><a href="#garbage-collection" class="header-anchor">#</a> Garbage collection</h2> <p>When an object is not referenced by any variable nor other object or becomes unreachable =&gt; it becomes garbage and python will make unused memory available for use, but when it gets returned to the OS depends.</p> <p>To check memory allocation:</p> <div class="language-python extra-class"><pre class="language-python"><code>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>nbytes <span class="token comment">## check memory allocation for numpy</span>


<span class="token comment">## check memory allocation for any object</span>
<span class="token keyword">def</span> <span class="token function">get_obj_size</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    marked <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">id</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">}</span>
    obj_q <span class="token operator">=</span> <span class="token punctuation">[</span>obj<span class="token punctuation">]</span>
    sz <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">while</span> obj_q<span class="token punctuation">:</span>
        sz <span class="token operator">+=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>getsizeof<span class="token punctuation">,</span> obj_q<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># Lookup all the object referred to by the object in obj_q.</span>
        <span class="token comment"># See: https://docs.python.org/3.7/library/gc.html#gc.get_referents</span>
        all_refr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">,</span> o<span class="token punctuation">)</span> <span class="token keyword">for</span> o <span class="token keyword">in</span> gc<span class="token punctuation">.</span>get_referents<span class="token punctuation">(</span><span class="token operator">*</span>obj_q<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># Filter object that are already marked.</span>
        <span class="token comment"># Using dict notation will prevent repeated objects.</span>
        new_refr <span class="token operator">=</span> <span class="token punctuation">{</span>o_id<span class="token punctuation">:</span> o <span class="token keyword">for</span> o_id<span class="token punctuation">,</span> o <span class="token keyword">in</span> all_refr <span class="token keyword">if</span> o_id <span class="token keyword">not</span> <span class="token keyword">in</span> marked <span class="token keyword">and</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">}</span>

        <span class="token comment"># The new obj_q will be the ones that were not marked,</span>
        <span class="token comment"># and we will update marked with their ids so we will</span>
        <span class="token comment"># not traverse them again.</span>
        obj_q <span class="token operator">=</span> new_refr<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
        marked<span class="token punctuation">.</span>update<span class="token punctuation">(</span>new_refr<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> sz
</code></pre></div><p>To clear memory for a dict:</p> <div class="language-python extra-class"><pre class="language-python"><code>a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token keyword">del</span> a<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token comment"># cut the binding to references; {'b': [4, 5, 6]}</span>
a<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token comment"># x = a['a']; del a['a']; return x</span>
a<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># assignment the true value to empty + clear hash set; {}</span>
</code></pre></div><p>To check number of references:</p> <div class="language-python extra-class"><pre class="language-python"><code>a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

<span class="token keyword">import</span> gc
gc<span class="token punctuation">.</span>get_referrers<span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token keyword">import</span> sys
sys<span class="token punctuation">.</span>getrefcount<span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment"># 2, as number of references plus 1 when `a` is passed to this function</span>
</code></pre></div><h2 id="subprocess"><a href="#subprocess" class="header-anchor">#</a> Subprocess</h2> <p>A child process becomes zombie if it exits or fails after its parent died. Be careful to avoid creating zombie processes:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># 1. use call</span>
subprocess<span class="token punctuation">.</span>call<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'grep'</span><span class="token punctuation">,</span> <span class="token string">'jdoe'</span><span class="token punctuation">,</span> <span class="token string">'/etc/passwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># wait for command to complete</span>

<span class="token comment"># 2. use communicate</span>
process <span class="token operator">=</span> Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token string">'-l'</span><span class="token punctuation">,</span> <span class="token string">'/tmp'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>PIPE<span class="token punctuation">)</span>
stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> process<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># read data from stdout and stderr, until end-of-file is reached.</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> proc<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>  <span class="token comment"># if after 15s subprocess not closed, process is not killed</span>
<span class="token keyword">except</span> TimeoutExpired<span class="token punctuation">:</span>
    proc<span class="token punctuation">.</span>kill<span class="token punctuation">(</span><span class="token punctuation">)</span>
    outs<span class="token punctuation">,</span> errs <span class="token operator">=</span> proc<span class="token punctuation">.</span>communicate<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 3. use wait</span>
process<span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token string">'-l'</span><span class="token punctuation">,</span> <span class="token string">'/tmp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>
process<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 4. if no wait, make sure you don't keep references to the Popen objects.</span>
<span class="token comment"># If python script exits, subprocess treats pid 1 as its parent</span>
Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;sleep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;30&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="concurrent-parallel"><a href="#concurrent-parallel" class="header-anchor">#</a> Concurrent &amp; Parallel</h2> <ol><li><p><code>multiprocessing</code> is designed for parallelism</p> <table><thead><tr><th style="text-align:left;"></th> <th style="text-align:left;">Multi-args</th> <th style="text-align:left;">Concurrence</th> <th style="text-align:left;">Blocking</th> <th style="text-align:left;">Ordered-results</th></tr></thead> <tbody><tr><td style="text-align:left;">apply</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">X</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">X</td></tr> <tr><td style="text-align:left;">apply_async</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">X</td> <td style="text-align:left;">X</td></tr> <tr><td style="text-align:left;">map</td> <td style="text-align:left;">X</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">map_async</td> <td style="text-align:left;">X</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">X</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">starmap</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">✔</td></tr> <tr><td style="text-align:left;">starmap_async</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">✔</td> <td style="text-align:left;">X</td> <td style="text-align:left;">X</td></tr></tbody></table> <ul><li><code>apply(func, args, kwds)</code>: lets the func run in child process but <strong>blocks</strong> the main process; same as <code>apply_async().get()</code>;</li> <li><code>apply_async(func, args, kwds, callback, error_callback)</code>: schedules the func and returns a async result object; order is multiple tasks is <strong>indeterminate</strong></li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># this function is called in main process</span>
<span class="token keyword">def</span> <span class="token function">a_back</span><span class="token punctuation">(</span>progress<span class="token punctuation">,</span> result<span class="token punctuation">,</span> saver<span class="token punctuation">)</span><span class="token punctuation">:</span>
    progress<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'sth'</span><span class="token punctuation">)</span>
    process_result<span class="token punctuation">(</span>result<span class="token punctuation">)</span>

<span class="token comment"># this function is called in main process</span>
<span class="token keyword">def</span> <span class="token function">b_back</span><span class="token punctuation">(</span>progress<span class="token punctuation">,</span> exception<span class="token punctuation">,</span> saver<span class="token punctuation">)</span><span class="token punctuation">:</span>
    progress<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'sth'</span><span class="token punctuation">)</span>
    process_exception<span class="token punctuation">(</span>exception<span class="token punctuation">)</span>

<span class="token comment"># exit: pool.terminate</span>
<span class="token keyword">with</span> mp<span class="token punctuation">.</span>Pool<span class="token punctuation">(</span>processes<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pool<span class="token punctuation">:</span>
    <span class="token keyword">with</span> tqdm<span class="token punctuation">(</span>total<span class="token operator">=</span>some_count<span class="token punctuation">)</span> <span class="token keyword">as</span> progress<span class="token punctuation">:</span>
        jobs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        saver <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> a_iterator<span class="token punctuation">:</span>
            job <span class="token operator">=</span> pool<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> kwds<span class="token operator">=</span>a_dict<span class="token punctuation">,</span> callback<span class="token operator">=</span><span class="token keyword">lambda</span> r<span class="token punctuation">:</span> a_back<span class="token punctuation">(</span>progress<span class="token punctuation">,</span> r<span class="token punctuation">,</span> saver<span class="token punctuation">)</span><span class="token punctuation">,</span> error_callback<span class="token operator">=</span><span class="token keyword">lambda</span> e<span class="token punctuation">:</span> b_back<span class="token punctuation">(</span>progress<span class="token punctuation">,</span> e<span class="token punctuation">,</span> saver<span class="token punctuation">)</span><span class="token punctuation">)</span>
            jobs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>job<span class="token punctuation">)</span>


        <span class="token comment"># to handle exception thrown in child processes</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> jobs<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                j<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># blocks main process, but other children are running in background</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token comment"># exception is still thrown even though it might be consumed once by error_callback</span>
                handle<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># alternatively, if no interest in exceptions</span>
        <span class="token comment"># pool.close()</span>
        <span class="token comment"># pool.join()</span>

process_saver<span class="token punctuation">(</span>saver<span class="token punctuation">)</span>
</code></pre></div><ul><li><code>map(func, [1,2,3,4])</code>: this method <strong>chops the iterable</strong> into a number of chunks which it submits to the process pool as separate tasks; <strong>blocks</strong> the main process; order is <strong>guaranteed</strong>; <code>map(func, [(1,2), (3,4)])</code> not working</li> <li><code>map_async(func, [1,2], callback, error_callback)</code>: order is <strong>guaranteed</strong></li></ul></li> <li><p><code>fork</code> vs <code>spawn</code></p> <p><code>spawn</code> is <code>fork</code> + <code>execve</code>: <a href="https://pythonspeed.com/articles/python-multiprocessing/" target="_blank" rel="noopener noreferrer">Ref<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ol> <h2 id="time"><a href="#time" class="header-anchor">#</a> Time</h2> <h3 id="get"><a href="#get" class="header-anchor">#</a> Get</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">import</span> pytz

<span class="token comment"># gets current time at local time zone</span>
datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># gets current time at another time zone</span>
datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'America/Chicago'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="create"><a href="#create" class="header-anchor">#</a> Create</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># creates a time with time zone, e.g., 2015-06-11</span>
my_datetime <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2015</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
my_tz <span class="token operator">=</span> pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'America/Chicago'</span><span class="token punctuation">)</span>
good_dt <span class="token operator">=</span> my_tz<span class="token punctuation">.</span>localize<span class="token punctuation">(</span>my_datetime<span class="token punctuation">)</span> <span class="token comment"># replace(tz=my_tz) gives wrong result: https://stackoverflow.com/a/50613134/6845273</span>
</code></pre></div><h3 id="switch"><a href="#switch" class="header-anchor">#</a> Switch</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> dateutil <span class="token keyword">import</span> parser
<span class="token keyword">from</span> dateutil <span class="token keyword">import</span> tz
<span class="token comment"># switch utc to GMT+08:00</span>
raw_time_str <span class="token operator">=</span> <span class="token string">'2021-11-03T09:53:10.683Z'</span>
from_zone <span class="token operator">=</span> tz<span class="token punctuation">.</span>gettz<span class="token punctuation">(</span><span class="token string">'UTC'</span><span class="token punctuation">)</span>
to_zone <span class="token operator">=</span> tz<span class="token punctuation">.</span>gettz<span class="token punctuation">(</span><span class="token string">'China/Shanghai'</span><span class="token punctuation">)</span>  <span class="token comment"># dateutil.tz is China/Shanghai, pytz is Asia/Shanghai</span>
utc <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>raw_time_str<span class="token punctuation">)</span>
utc <span class="token operator">=</span> utc<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>tzinfo<span class="token operator">=</span>from_zone<span class="token punctuation">)</span>
utc<span class="token punctuation">.</span>astimezone<span class="token punctuation">(</span>to_zone<span class="token punctuation">)</span>
</code></pre></div><h3 id="parser"><a href="#parser" class="header-anchor">#</a> Parser</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> dateparser

<span class="token comment"># parse with custom format, custom locale, beginning year</span>
dateparser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>time_string<span class="token punctuation">,</span> date_formats<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> settings<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'DATE_ORDER'</span><span class="token punctuation">:</span> <span class="token string">'DMY'</span><span class="token punctuation">,</span> <span class="token string">'RELATIVE_BASE'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">(</span><span class="token number">2001</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'PARSERS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'custom-formats'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span> locales<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'en'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> dateutil <span class="token keyword">import</span> parser
parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>time_string<span class="token punctuation">)</span>
</code></pre></div><table><thead><tr><th>query</th> <th>dateutil</th> <th>dateparser</th></tr></thead> <tbody><tr><td>2016/09/01</td> <td>1</td> <td>1</td></tr> <tr><td>2016-09-01</td> <td>1</td> <td>1</td></tr> <tr><td>09/01/2016</td> <td>1</td> <td>1</td></tr> <tr><td>09-01-2016</td> <td>1</td> <td>1</td></tr> <tr><td>09012016</td> <td>0</td> <td>0</td></tr> <tr><td>09/01/2016 15:20</td> <td>1</td> <td>1</td></tr> <tr><td>09/01/2016 at 15h20</td> <td>1</td> <td>1</td></tr> <tr><td>15 min ago</td> <td>0</td> <td>1</td></tr> <tr><td>two hours ago</td> <td>0</td> <td>1</td></tr> <tr><td>a day ago</td> <td>0</td> <td>1</td></tr> <tr><td>tuesday</td> <td>0</td> <td>1</td></tr> <tr><td>monday at noon</td> <td>0</td> <td>1</td></tr> <tr><td>-------------------------</td> <td>----------</td> <td>----------</td></tr> <tr><td>total (12)</td> <td>6</td> <td>11</td></tr></tbody></table> <h3 id="operation"><a href="#operation" class="header-anchor">#</a> Operation</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># subtract</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
<span class="token keyword">import</span> pytz
d <span class="token operator">=</span> datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>days_to_subtract<span class="token punctuation">)</span>

<span class="token comment"># create from timestamp</span>
date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>fromtimestamp<span class="token punctuation">(</span>ten_digit_ts<span class="token punctuation">,</span> pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ide"><a href="#ide" class="header-anchor">#</a> IDE</h2> <h3 id="pycharm"><a href="#pycharm" class="header-anchor">#</a> Pycharm</h3> <ol><li><p>dependency</p> <blockquote><p>adds local folder to library root [interpreter settings] =&gt; adds to interpreter path =&gt; adds to <code>sys.path</code></p></blockquote> <blockquote><p>python setup.py =&gt; adds a soft link in site-packages =&gt; <code>sys.path</code> contains site-packages</p></blockquote> <blockquote><p>adds a folder as source root =&gt; adds to PYTHONPATH =&gt; adds to <code>sys.path</code></p></blockquote> <blockquote><p>if <code>PATH</code> is edited in run config, its value would automatically be <code>new_value:$PATH</code></p></blockquote></li> <li><p>profiler</p></li></ol> <p>own time: time spent without childen</p> <ol><li>locale</li></ol> <p><code>LC_CTYPE</code> is empty by default in runner, and <code>C</code> in pycharm termimal</p> <h3 id="conda"><a href="#conda" class="header-anchor">#</a> Conda</h3> <p>channels can be modified at ~/.condarc</p> <p>some activation magic at #CONDA_PREFIX/etc/conda/activate.d</p> <p>useful commands:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># refresh a package</span>
conda <span class="token function">install</span> --force-reinstall package

<span class="token comment"># view package dependencies</span>
<span class="token comment"># or at https://libraries.io/</span>
conda create --dry-run --json -n dummy package

<span class="token comment"># search multiple channels for packages</span>
conda <span class="token function">install</span> -c channel1 -c channel2 package

<span class="token comment"># view current env path</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$CONDA_PREFIX</span>

<span class="token comment"># remove env</span>
conda <span class="token function">env</span> remove -n env_name
conda <span class="token function">env</span> remove -p env_path
</code></pre></div><h3 id="pip"><a href="#pip" class="header-anchor">#</a> pip</h3> <p>useful commands</p> <div class="language-bash extra-class"><pre class="language-bash"><code>
<span class="token comment"># reinstall a package</span>
pip <span class="token function">install</span> --force-reinstall <span class="token assign-left variable">package</span><span class="token operator">==</span>version

<span class="token comment"># generate requirements.txt</span>
pip freeze <span class="token operator">&gt;</span> requirements.txt

<span class="token comment"># ignore installed version</span>
pip <span class="token function">install</span> -I

<span class="token comment"># search in pypi first</span>
<span class="token comment"># then search in extra url</span>
<span class="token comment"># for pip 20.xx, choosing the latest possible version in the combined set</span>
<span class="token comment"># for pip 21.xx additional compatibility check is done</span>
pip <span class="token function">install</span> --extra-index-url https://123.com

<span class="token comment"># view installation logs</span>
<span class="token assign-left variable">TMPDIR</span><span class="token operator">=</span>./tmp pip <span class="token function">install</span> --no-clean

<span class="token comment"># fresh install without using any cache(e.g., built/downloaded wheels)</span>
pip <span class="token function">install</span> --no-cache-dir

<span class="token comment"># fresh install without using any binary =&gt; build binary locally</span>
pip <span class="token function">install</span> --no-binary :all:

<span class="token string">&quot;&quot;</span>&quot;
When making build requirements available, pip does so <span class="token keyword">in</span> an isolated environment.
That is, pip does not <span class="token function">install</span> those requirements into the user’s site-packages, but
rather installs them <span class="token keyword">in</span> a temporary directory <span class="token function">which</span> it adds to the user’s sys.path
<span class="token keyword">for</span> the duration of the build. This ensures that build requirements are handled
independently of the user’s runtime environment. For example, a project that needs
a recent version of setuptools to build can still be installed, even <span class="token keyword">if</span> the user has
 an older version installed <span class="token punctuation">(</span>and without silently replacing that version<span class="token punctuation">)</span>.

n certain cases, projects <span class="token punctuation">(</span>or redistributors<span class="token punctuation">)</span> may have workflows that explicitly
manage the build environment. For such workflows, build isolation can be
problematic. If this is the case, pip provides a --no-build-isolation
flag to disable build isolation. Users supplying this flag are responsible
<span class="token keyword">for</span> ensuring the build environment is managed appropriately <span class="token punctuation">(</span>including ensuring
that all required build dependencies are installed<span class="token punctuation">)</span>.

build requirements are specifed <span class="token keyword">in</span> pyproject.toml<span class="token punctuation">(</span>EP <span class="token number">518</span><span class="token punctuation">)</span>, e.g.,
<span class="token punctuation">[</span>build-system<span class="token punctuation">]</span>
requires <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;setuptools&quot;</span>,
    <span class="token string">&quot;cython&gt;=0.25,&lt;3.0&quot;</span>,
    <span class="token string">&quot;cymem&gt;=2.0.2,&lt;2.1.0&quot;</span>,
    <span class="token string">&quot;preshed&gt;=3.0.2,&lt;3.1.0&quot;</span>,
    <span class="token string">&quot;murmurhash&gt;=0.28.0,&lt;1.1.0&quot;</span>,
    <span class="token string">&quot;thinc&gt;=8.0.12,&lt;8.1.0&quot;</span>,
    <span class="token string">&quot;blis&gt;=0.4.0,&lt;0.8.0&quot;</span>,
    <span class="token string">&quot;pathy&quot;</span>,
    <span class="token string">&quot;numpy&gt;=1.15.0&quot;</span>,
<span class="token punctuation">]</span>
build-backend <span class="token operator">=</span> <span class="token string">&quot;setuptools.build_meta&quot;</span>
<span class="token string">&quot;&quot;</span>&quot;
pip <span class="token function">install</span> --no-build-isolation

pipdeptree -fl  <span class="token comment"># examine depency tree</span>

pip --dry-run
</code></pre></div><h2 id="yaml"><a href="#yaml" class="header-anchor">#</a> yaml</h2> <p><a href="https://github.com/commx/ruamel-yaml" target="_blank" rel="noopener noreferrer"><code>ruamel</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is derivative of <code>PyYAML</code> and not actively developed. <code>PyYAML</code> supports the YAML 1.1 standard, <code>ruamel</code> supports YAML 1.2 as released in 2009.</p> <p>More:</p> <ul><li><code>PyYAML</code> YAML 1.2 status: https://github.com/yaml/pyyaml/issues/116</li></ul> <h3 id="disable-alias"><a href="#disable-alias" class="header-anchor">#</a> Disable alias</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> ruamel<span class="token punctuation">.</span>yaml

<span class="token keyword">class</span> <span class="token class-name">NonAliasingRTRepresenter</span><span class="token punctuation">(</span>ruamel<span class="token punctuation">.</span>yaml<span class="token punctuation">.</span>representer<span class="token punctuation">.</span>RoundTripRepresenter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">ignore_aliases</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

yaml <span class="token operator">=</span> ruamel<span class="token punctuation">.</span>yaml<span class="token punctuation">.</span>YAML<span class="token punctuation">(</span><span class="token punctuation">)</span>
yaml<span class="token punctuation">.</span>Representer <span class="token operator">=</span> NonAliasingRTRepresenter

yaml<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>data<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
</code></pre></div><h3 id="partial-flow"><a href="#partial-flow" class="header-anchor">#</a> Partial flow</h3> <p>YAML calls the indentation style “block” and the JSON style “flow”. Flow style can be used at any point within the block style.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> ruamel<span class="token punctuation">.</span>yaml

<span class="token keyword">def</span> <span class="token function">L</span><span class="token punctuation">(</span><span class="token operator">*</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
   ret <span class="token operator">=</span> ruamel<span class="token punctuation">.</span>yaml<span class="token punctuation">.</span>comments<span class="token punctuation">.</span>CommentedSeq<span class="token punctuation">(</span>l<span class="token punctuation">)</span>
   ret<span class="token punctuation">.</span>fa<span class="token punctuation">.</span>set_flow_style<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">return</span> ret

yaml <span class="token operator">=</span> ruamel<span class="token punctuation">.</span>yaml<span class="token punctuation">.</span>YAML<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
data<span class="token punctuation">[</span><span class="token string">'users'</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">(</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'users'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'user2 key1'</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'users'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'user2 key2'</span><span class="token punctuation">)</span>
data<span class="token punctuation">[</span><span class="token string">'users2'</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> L<span class="token punctuation">(</span><span class="token string">'user2 group1'</span><span class="token punctuation">,</span> <span class="token string">'user2 group2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
yaml<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>data<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
users: [user2 key1, user2 key2]
users2: [abc, [user2 group1, user2 group2]]
&quot;&quot;&quot;</span>
</code></pre></div><h3 id="multiline"><a href="#multiline" class="header-anchor">#</a> Multiline</h3> <p>http://yaml-multiline.info/</p> <h2 id="miscellaneous"><a href="#miscellaneous" class="header-anchor">#</a> Miscellaneous</h2> <ol><li><p><code>strip</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">&quot;[1,2,3,4]&quot;</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">&quot;[1,2,]&quot;</span><span class="token punctuation">)</span> <span class="token comment"># &quot;3,4&quot;, any combination</span>
</code></pre></div></li> <li><p><code>find</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">&quot;123&quot;</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span> <span class="token comment"># 0</span>
</code></pre></div></li> <li><p>raw string</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">r&quot;\x&quot;</span> <span class="token comment"># &quot;\\x&quot;</span>
r'\' <span class="token comment"># SyntaxError</span>
<span class="token string">r&quot;\\&quot;</span> <span class="token comment"># &quot;\\\\&quot;</span>
<span class="token string">&quot;\s&quot;</span>  <span class="token comment"># &quot;\\s&quot;</span>
<span class="token string">r&quot;\s&quot;</span>  <span class="token comment"># &quot;\\s&quot;</span>
<span class="token string">&quot;\f&quot;</span>  <span class="token comment"># \x0c</span>
<span class="token string">r&quot;\f&quot;</span>  <span class="token comment"># \\f</span>
</code></pre></div></li> <li><p><code>pathlib</code></p> <div class="language-python extra-class"><pre class="language-python"><code>pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">.</span>cwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># current work directory</span>
pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># absolute path of current file</span>
p <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">&quot;/home/user/Downloads/repo/test.txt&quot;</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>stem <span class="token comment"># test name without extension</span>
p<span class="token punctuation">.</span>name <span class="token comment"># test.txt full name</span>
json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'123.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># directory</span>
os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>realpath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># directory and filename</span>

pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'123/456/789/12.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'123/456/789/12.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parent
pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'123/456/789/12.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> pathlib<span class="token punctuation">.</span>Path<span class="token punctuation">(</span><span class="token string">'123/456/789/12.txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parent<span class="token punctuation">.</span>parent
</code></pre></div><blockquote><p>return of <code>Path</code> is a special class <br>
it can be used with <code>/</code> <br> <code>pathlib.Path.cwd() / &quot;dir&quot;</code></p></blockquote></li> <li><p><code>shutil</code></p> <div class="language-python extra-class"><pre class="language-python"><code>shutil<span class="token punctuation">.</span>copyfileobj<span class="token punctuation">(</span>f<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span> <span class="token comment"># similar like cat</span>
shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>f<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token comment"># target must not exist, and target can in different disk</span>
os<span class="token punctuation">.</span>rename <span class="token comment"># target must not exist, and target in the same disk</span>
os<span class="token punctuation">.</span>replace <span class="token comment"># target can exist, and target in the same disk</span>

Path<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>rename<span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token comment"># Unix: target can exist. Target can in different disk. Similar like mv command.</span>
Path<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span>replace <span class="token comment"># target can exist in any os. Target can in different disk.</span>
</code></pre></div></li> <li><p><code>dict</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>keyname<span class="token punctuation">,</span> valueifkeynotexist<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># error</span>
<span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># ok</span>
</code></pre></div></li> <li><p>encoding</p> <blockquote><p>utf-8 excel contains dummy string, so using utf_8_sig</p></blockquote> <blockquote><p><code>open()</code> 's encoding is decided by environment's <code>locale</code> and can be <strong>check</strong> by <code>python -c 'import locale; print(locale.getpreferredencoding())'</code>, can be <strong>set</strong> by <code>export LC_ALL=en_US.UTF-8 export LANG=en_US.UTF-8</code></p></blockquote> <blockquote><p>python 3.6, <code>invalid_country.UTF-8</code> (this country not exsit in <code>locale -a</code>) leads <code>preferredencoding</code> to be ascii; python 3.7, this problem does not exist</p></blockquote> <blockquote><p><code>sys.stdout.encoding</code>'s encoding is decided by environment's <code>locale</code> and can be <strong>set</strong> by <code>PYTHONIOENCODING=UTF-8</code></p></blockquote> <blockquote><p><code>b'123'</code> -&gt; <code>'123'</code>: <br> <code>b'123'.decode('utf-8')</code></p></blockquote></li> <li><p>string decomposition</p> <p>Takes <code>⑴</code>, <code>①</code>, <code>è</code> and <code>프</code> for consideration:</p> <ul><li><p><code>unicodedata.normalize('NFD', text)</code>, canonical equivalence: <code>è</code> or <code>프</code></p></li> <li><p><code>unicodedata.normalize('NFKD', text)</code>, compatibility equivalence: <code>⑴</code>, <code>①</code>, <code>è</code> and <code>프</code></p></li> <li><p><code>unicodedata.decomposition(text)</code>, <a href="https://stackoverflow.com/a/49235697/6845273" target="_blank" rel="noopener noreferrer">special format<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: <code>⑴</code>, <code>①</code>, <code>è</code></p></li></ul> <p><code>unicodedata.category(char)</code> can be used to check if a character is unwanted <a href="https://www.fileformat.info/info/unicode/category/index.htm" target="_blank" rel="noopener noreferrer">accent mark<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>doc</p> <ul><li><code>dir(object)</code>: check all attributes</li> <li><code>object.attr.__doc__</code>: check how to use</li> <li><code>?object.attr</code> in jupyter to check how to use</li> <li><code>inspect.getsource(object.method)</code>: check source code</li></ul></li> <li><p>yield</p> <p>return a generator to save space and some code</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">countdown_gen</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> x
    <span class="token keyword">while</span> count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> count
        count <span class="token operator">-=</span> <span class="token number">1</span>

g <span class="token operator">=</span> countdown_gen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> item <span class="token keyword">in</span> g<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token comment"># 5, 4, 3, 2, 1</span>
</code></pre></div><p>assign a value back to yield</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">getPrimes</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> isPrime<span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">:</span>
            number <span class="token operator">=</span> <span class="token keyword">yield</span> number <span class="token comment"># generator returns number, and assign value sent to number</span>
        number <span class="token operator">+=</span> <span class="token number">1</span>

gen <span class="token operator">=</span> getPrimes<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
gen<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment"># first sent must be None</span>
<span class="token comment"># next(gen) =&gt; gen.send(None)</span>
<span class="token comment"># 11</span>
<span class="token comment"># execution stuck at yield</span>


gen<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment"># number becomes 10 and starts another round iteration</span>
<span class="token comment"># 11</span>
<span class="token comment"># execution stuck at yield</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">translator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># load all the words in English language and the translation to 'other lang'</span>
    my_words_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'hello'</span><span class="token punctuation">:</span> <span class="token string">'hello in other language'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">:</span> <span class="token string">'dog in other language'</span><span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        word <span class="token operator">=</span> <span class="token keyword">yield</span>
        <span class="token keyword">yield</span> my_words_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token string">'Unknown word...'</span><span class="token punctuation">)</span>

my_words_translator <span class="token operator">=</span> translator<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token builtin">next</span><span class="token punctuation">(</span>my_words_translator<span class="token punctuation">)</span> <span class="token comment"># stuck in first yield</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>my_words_translator<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'dog'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># assign value to word and stuck in send yield</span>

<span class="token builtin">next</span><span class="token punctuation">(</span>my_words_translator<span class="token punctuation">)</span> <span class="token comment"># stuck in first yield again</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>my_words_translator<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'cat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>throw exception</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">add_to_database</span><span class="token punctuation">(</span>connection_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> mydatabaselibrary<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>connection_string<span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                row <span class="token operator">=</span> <span class="token keyword">yield</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'INSERT INTO mytable VALUES(?, ?, ?)'</span><span class="token punctuation">,</span> row<span class="token punctuation">)</span>
            <span class="token keyword">except</span> CommitException<span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'COMMIT'</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> AbortException<span class="token punctuation">:</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'ABORT'</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'ABORT'</span><span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

db <span class="token operator">=</span> add_to_database<span class="token punctuation">(</span><span class="token string">'bla'</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token comment"># opens a database connection</span>
db<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'bla'</span><span class="token punctuation">)</span> <span class="token comment"># insert a row</span>
db<span class="token punctuation">.</span>throw<span class="token punctuation">(</span>CommitException<span class="token punctuation">)</span> <span class="token comment"># abort the transaction</span>
</code></pre></div><p>yield from: transparent two way channel between the caller and the sub-generator, <a href="https://stackoverflow.com/a/26109157/6845273" target="_blank" rel="noopener noreferrer">more info<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, but one simple usage is generating values from a iterator</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">flatten</span><span class="token punctuation">(</span>sequence<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;flatten a multi level list or something
&gt;&gt;&gt; list(flatten([1, [2], 3]))
[1, 2, 3]
&gt;&gt;&gt; list(flatten([1, [2], [3, [4]]]))
[1, 2, 3, 4]
&quot;&quot;&quot;</span>
<span class="token keyword">for</span> element <span class="token keyword">in</span> sequence<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">'__iter__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> <span class="token keyword">from</span> flatten<span class="token punctuation">(</span>element<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> element
</code></pre></div></li> <li><p>naming
variable, package: <code>identifier ::= (letter|&quot;_&quot;) (letter | digit | &quot;_&quot;)*</code>, if breaking rules, interpreter error occurs</p> <div class="custom-block tip"><p class="custom-block-title">Invalid Import</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> importlib <span class="token keyword">import</span> import_module
<span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'module-name'</span><span class="token punctuation">)</span>
</code></pre></div></div></li> <li><p>declaration hoisting</p> <p>There is no hoisting in python</p></li> <li><p>lambda</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">lambda</span> <span class="token operator">*</span>x<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># supports var_args</span>
</code></pre></div></li> <li><p>json</p> <p><code>json.dump(ensure_ascii=True)</code>: saves <code>我</code> into <code>\u6211</code>, which can be read in any encoding as <code>\u6211</code> <br> <code>json.loads()</code>: handles <code>\u6211</code> as <code>我</code></p> <div class="language-python extra-class"><pre class="language-python"><code>json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;我&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'123.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'123.json'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'latin_1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> reader<span class="token punctuation">:</span>  <span class="token comment"># any encoding</span>
    read_text <span class="token operator">=</span> reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    json_text <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>read_text<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>read_text<span class="token punctuation">)</span>  <span class="token comment"># \u6211</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>json_text<span class="token punctuation">)</span>  <span class="token comment"># 我</span>

json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;我&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'123.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'123.json'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'latin_1'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> reader<span class="token punctuation">:</span>  <span class="token comment"># encoding error</span>
    read_text <span class="token operator">=</span> reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    json_text <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>read_text<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>read_text<span class="token punctuation">)</span>  <span class="token comment"># {&quot;text&quot;: &quot;æ&quot;}</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>json_text<span class="token punctuation">)</span>  <span class="token comment"># {'text': 'æ\x88\x91'}</span>
</code></pre></div><p>Take care control characters while <code>json.loads()</code></p> <div class="language-python extra-class"><pre class="language-python"><code>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'{&quot;apple&quot;: &quot;good\nfruit&quot;}'</span><span class="token punctuation">,</span> strict<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">r'{&quot;apple&quot;: &quot;good\nfruit&quot;}'</span><span class="token punctuation">)</span>
</code></pre></div><p>More examples</p> <div class="language-python extra-class"><pre class="language-python"><code>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'[&quot;\\u00b9&quot;]'</span><span class="token punctuation">)</span>
json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span><span class="token string">'[&quot;¹&quot;]'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>split</code></p> <p>If sep is not specified or is None, a different splitting algorithm is applied: runs of consecutive whitespace are regarded as a single separator, and the result will contain no empty strings at the start or end if the string has leading or trailing whitespace. Consequently, splitting an empty string or a string consisting of just whitespace with a None separator returns [].</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">' a b c '</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ['a', 'b', 'c']</span>
<span class="token string">' a b c '</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>  <span class="token comment"># ['', 'a', 'b', 'c', '']</span>
</code></pre></div></li> <li><p>variable scope</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">kk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">gg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    gg<span class="token punctuation">(</span><span class="token punctuation">)</span>
    value <span class="token operator">=</span> <span class="token number">10</span>
    gg<span class="token punctuation">(</span><span class="token punctuation">)</span>

kk<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment"># 3</span>
<span class="token comment"># 10</span>
</code></pre></div></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/1/2024, 4:22:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/python/Web.html">
        Web
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.3fa2a2e1.js" defer></script><script src="/assets/js/2.057925ea.js" defer></script><script src="/assets/js/29.f0ca98d8.js" defer></script>
  </body>
</html>
